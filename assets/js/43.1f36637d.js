(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{520:function(t,s,a){"use strict";a.r(s);var e=a(19),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"搭建k8s集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搭建k8s集群"}},[t._v("#")]),t._v(" 搭建k8s集群")]),t._v(" "),a("h2",{attrs:{id:"主机名映射"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主机名映射"}},[t._v("#")]),t._v(" 主机名映射")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /etc/hosts\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1\tlocalhost\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.130   k8s-master\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.131   k8s-slave\n")])])]),a("p",[t._v("主机名和IP加入到hostname")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /etc/hostname\n")])])]),a("h2",{attrs:{id:"在所有节点上安装kubeadm-这里使用阿里云的系统和kubernetes的源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在所有节点上安装kubeadm-这里使用阿里云的系统和kubernetes的源"}},[t._v("#")]),t._v(" 在所有节点上安装kubeadm，这里使用阿里云的系统和kubernetes的源")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("root@k8s-master:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## cat /etc/apt/sources.list")]),t._v("\ndeb http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse\n\ndeb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main\n")])])]),a("h2",{attrs:{id:"更新源并安装kubeadm-kubectl-kubelet软件包-安装docker-io-非docker-ce"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新源并安装kubeadm-kubectl-kubelet软件包-安装docker-io-非docker-ce"}},[t._v("#")]),t._v(" 更新源并安装kubeadm, kubectl, kubelet软件包;安装docker.io(非docker-ce)")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update -y "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y kubelet kubeadm kubectl --allow-unauthenticated\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" docker.io -y\n\n")])])]),a("h2",{attrs:{id:"使用kubeadmin初始化master节点-这里有两个坑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用kubeadmin初始化master节点-这里有两个坑"}},[t._v("#")]),t._v(" 使用kubeadmin初始化master节点，这里有两个坑！！")]),t._v(" "),a("ul",[a("li",[t._v("坑1、使用网络上常见的方式，那么如果没有用vpn翻墙，那么则会卡住，无法下载，幸好v1.13.0版本无需翻墙，指定版本即可")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("kubeadm init "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--image-repository registry.aliyuncs.com/google_containers "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--kubernetes-version v1.13.0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--pod-network-cidr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".0.0/16 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--apiserver-advertise-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.130\n")])])]),a("ul",[a("li",[t._v("坑2、需要禁用swap"),a("br"),t._v("\n修改/etc/fstab")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("root@k8s-master:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## cat /etc/fstab ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## /etc/fstab: static file system information.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## Use 'blkid' to print the universally unique identifier for a")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## device; this may be used with UUID= as a more robust way to name devices")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## that works even if disks are added and removed. See fstab(5).")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## <file system> <mount point>   <type>  <options>       <dump>  <pass>")]),t._v("\n/dev/mapper/ubuntugustave--vg-root /               ext4    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("errors")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("remount-ro "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## /boot was on /dev/sda1 during installation")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## UUID=340c3d0f-eb29-4512-83ca-ef6ba9d8577f /boot           ext2    defaults        0       2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## /dev/mapper/ubuntugustave--vg-swap_1 none            swap    sw              0       0")]),t._v("\n")])])]),a("p",[t._v("修改之后执行"),a("code",[t._v("swapoff -a")]),a("br"),t._v("\n如果还不行 "),a("code",[t._v("kubeadm reset")])]),t._v(" "),a("h2",{attrs:{id:"大功告成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#大功告成"}},[t._v("#")]),t._v(" 大功告成")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("root@k8s-master:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## kubeadm init --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.13.0 --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=192.168.213.130")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using Kubernetes version: v1.13.0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running pre-flight checks\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulling images required "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" setting up a Kubernetes cluster\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" This might take a minute or two, depending on the speed of your internet connection\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" You can also perform this action "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" beforehand using "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubeadm config images pull'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet environment "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with flags to "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/kubeadm-flags.env"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet configuration to "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/config.yaml"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Activating the kubelet "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using certificateDir folder "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes/pki"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"etcd/ca"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"etcd/healthcheck-client"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"etcd/server"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" etcd/server serving cert is signed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" DNS names "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("k8s-master localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" and IPs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.130 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1 ::1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"etcd/peer"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" etcd/peer serving cert is signed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" DNS names "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("k8s-master localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" and IPs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.130 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1 ::1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apiserver-etcd-client"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ca"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apiserver-kubelet-client"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apiserver"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" apiserver serving cert is signed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" DNS names "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("k8s-master kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" and IPs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.96")]),t._v(".0.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.130"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"front-proxy-ca"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"front-proxy-client"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sa"')]),t._v(" key and public key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using kubeconfig folder "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin.conf"')]),t._v(" kubeconfig "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubelet.conf"')]),t._v(" kubeconfig "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"controller-manager.conf"')]),t._v(" kubeconfig "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scheduler.conf"')]),t._v(" kubeconfig "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using manifest folder "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes/manifests"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating static Pod manifest "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-apiserver"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating static Pod manifest "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-controller-manager"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating static Pod manifest "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-scheduler"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("etcd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating static Pod manifest "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v(" etcd "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes/manifests"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("wait-control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Waiting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelet to boot up the control plane as static Pods from directory "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes/manifests"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" This can take up to 4m0s\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("apiclient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" All control plane components are healthy after "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("28.005554")]),t._v(" seconds\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("uploadconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" storing the configuration used "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ConfigMap "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubeadm-config"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-system"')]),t._v(" Namespace\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating a ConfigMap "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubelet-config-1.13"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" namespace kube-system with the configuration "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelets "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the cluster\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("patchnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Uploading the CRI Socket information "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/run/dockershim.sock"')]),t._v(" to the Node API object "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"k8s-master"')]),t._v(" as an annotation\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mark-control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Marking the node k8s-master as control-plane by adding the label "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"node-role.kubernetes.io/master=''\"")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mark-control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Marking the node k8s-master as control-plane by adding the taints "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("node-role.kubernetes.io/master:NoSchedule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using token: 3lnb74.tku3cdu5bagn0air\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstraptoken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" configured RBAC rules to allow Node Bootstrap tokens to post CSRs "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" order "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" nodes to get long term certificate credentials\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstraptoken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstraptoken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" configured RBAC rules to allow certificate rotation "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" all node client certificates "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the cluster\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstraptoken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" creating the "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cluster-info"')]),t._v(" ConfigMap "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-public"')]),t._v(" namespace\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("addons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Applied essential addon: CoreDNS\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("addons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Applied essential addon: kube-proxy\n\nYour Kubernetes master has initialized successfully"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -i /etc/kubernetes/admin.conf "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -u"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -g"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n\nYou should now deploy a pod network to the cluster.\nRun "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubectl apply -f [podnetwork].yaml"')]),t._v(" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nYou can now "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" any number of machines by running the following on each node\nas root:\n\n  kubeadm "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.130:6443 --token 3lnb74.tku3cdu5bagn0air --discovery-token-ca-cert-hash sha256:2ba48ce20ebefcfb6d07ddf01141590eb81cad5de5c0406f08f41faab26a8696\n")])])]),a("ul",[a("li",[t._v("按图索骥,按指示的方式配置k8s就行了,其中最后显示的kubeadm join语句包含了节点添加的token等等")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -i /etc/kubernetes/admin.conf "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -u"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -g"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n")])])]),a("h2",{attrs:{id:"安装网络插件canal"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装网络插件canal"}},[t._v("#")]),t._v(" 安装网络插件canal")]),t._v(" "),a("ul",[a("li",[t._v("执行如下两条命令即可")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("kubectl apply -f https://docs.projectcalico.org/v3.1/getting-started/kubernetes/installation/hosted/canal/rbac.yaml\n \nclusterrole.rbac.authorization.k8s.io "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"calico"')]),t._v(" created\nclusterrole.rbac.authorization.k8s.io "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"flannel"')]),t._v(" created\nclusterrolebinding.rbac.authorization.k8s.io "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"canal-flannel"')]),t._v(" created\nclusterrolebinding.rbac.authorization.k8s.io "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"canal-calico"')]),t._v(" created\n \n \nkubectl apply -f https://docs.projectcalico.org/v3.1/getting-started/kubernetes/installation/hosted/canal/canal.yaml\n \nconfigmap "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"canal-config"')]),t._v(" created\ndaemonset.extensions "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"canal"')]),t._v(" created\ncustomresourcedefinition.apiextensions.k8s.io "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"felixconfigurations.crd.projectcalico.org"')]),t._v(" created\ncustomresourcedefinition.apiextensions.k8s.io "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bgpconfigurations.crd.projectcalico.org"')]),t._v(" created\ncustomresourcedefinition.apiextensions.k8s.io "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ippools.crd.projectcalico.org"')]),t._v(" created\ncustomresourcedefinition.apiextensions.k8s.io "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"clusterinformations.crd.projectcalico.org"')]),t._v(" created\ncustomresourcedefinition.apiextensions.k8s.io "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"globalnetworkpolicies.crd.projectcalico.org"')]),t._v(" created\ncustomresourcedefinition.apiextensions.k8s.io "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"networkpolicies.crd.projectcalico.org"')]),t._v(" created\nserviceaccount "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"canal"')]),t._v(" created\n\n")])])]),a("h2",{attrs:{id:"执行如下命令-可以就可以查看canal的安装状态了"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行如下命令-可以就可以查看canal的安装状态了"}},[t._v("#")]),t._v(" 执行如下命令，可以就可以查看canal的安装状态了")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("root@k8s-master:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## kubectl get pod -n kube-system -o wide")]),t._v("\nNAME                                 READY   STATUS    RESTARTS   AGE   IP                NODE         NOMINATED NODE   READINESS GATES\ncanal-6f6kk                          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("/3     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          58m   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.130   k8s-master   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\ncanal-rgb57                          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("/3     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          50m   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.131   k8s-slave    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\ncoredns-78d4cf999f-hp7cv             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          64m   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".0.3        k8s-master   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\ncoredns-78d4cf999f-p4r7w             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          64m   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".0.2        k8s-master   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\netcd-k8s-master                      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          69m   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.130   k8s-master   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-apiserver-k8s-master            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          68m   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.130   k8s-master   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-controller-manager-k8s-master   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          69m   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.130   k8s-master   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-proxy-fknxh                     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          50m   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.131   k8s-slave    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-proxy-pvt8w                     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          69m   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.130   k8s-master   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-scheduler-k8s-master            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          69m   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.130   k8s-master   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("h2",{attrs:{id:"查看节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看节点"}},[t._v("#")]),t._v(" 查看节点")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("kubectl get nodes\n")])])]),a("h2",{attrs:{id:"slave节点在集群中的操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#slave节点在集群中的操作"}},[t._v("#")]),t._v(" slave节点在集群中的操作")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    kubectl get nodes\n")])])]),a("h2",{attrs:{id:"增加新的node节点到你的集群的命令如下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增加新的node节点到你的集群的命令如下"}},[t._v("#")]),t._v(" 增加新的Node节点到你的集群的命令如下：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("  kubeadm "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".213.130:6443 --token 3lnb74.tku3cdu5bagn0air --discovery-token-ca-cert-hash sha256:2ba48ce20ebefcfb6d07ddf01141590eb81cad5de5c0406f08f41faab26a8696\n")])])]),a("ul",[a("li",[t._v("token，一般token两天就过期了，如果过期了你需要重新创建（查看token命令是kubeadm token list，创建token命令是kubeadm token create)，如下：")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("root@k8s-master:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## kubeadm token list")]),t._v("\nTOKEN                     TTL       EXPIRES                     USAGES                   DESCRIPTION                                                EXTRA "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("GROUPS")]),t._v("\n3lnb74.tku3cdu5bagn0air   22h       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-01-08T14:59:55+08:00   authentication,signing   The default bootstrap token generated by "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubeadm init'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("   system:bootstrappers:kubeadm:default-node-token\n")])])]),a("ul",[a("li",[t._v("--discovery-token-ca-cert-hash，通过如下命令就可以得到")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("root@k8s-master:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'")]),t._v("\n2ba48ce20ebefcfb6d07ddf01141590eb81cad5de5c0406f08f41faab26a8696\n")])])]),a("h2",{attrs:{id:"删除slave节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除slave节点"}},[t._v("#")]),t._v(" 删除slave节点")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("kubectl drain "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("node name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" --delete-local-data --force --ignore-daemonsets\nkubectl delete node "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("node name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);