(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{561:function(t,s,n){"use strict";n.r(s);var a=n(19),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"物理备份的恢复"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#物理备份的恢复"}},[t._v("#")]),t._v(" 物理备份的恢复")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://help.aliyun.com/knowledge_detail/41817.html?spm=5176.10695662.1996646101.searchclickresult.4aca2e25JZhG1n&aly_as=OF-4wSKB",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方链接"),n("OutboundLink")],1)]),t._v(" "),n("ul",[n("li",[n("p",[t._v("存在问题，因为我们是要恢复到docker上的自建数据库，使用mysqld_safe命令启动，我们不好操作")])]),t._v(" "),n("li",[n("p",[t._v("其实只需要吧对应的数据指向容器的/var/lib/mysql 配置指向/etc/my.cnf即可")])]),t._v(" "),n("li",[n("p",[t._v("backup-my.cnf需要修改")])])]),t._v(" "),n("div",{staticClass:"language-properties extra-class"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## This MySQL options file was generated by innobackupex.")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## The MySQL server")]),t._v("\n[mysqld]\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##innodb_checksum_algorithm=innodb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##innodb_log_checksum_algorithm=innodb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##innodb_data_file_path=ibdata1:200M:autoextend")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##innodb_log_files_in_group=2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##innodb_log_file_size=1048576000")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##innodb_fast_checksum=false")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##innodb_page_size=16384")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##innodb_log_block_size=512")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##innodb_undo_directory=.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##innodb_undo_tablespaces=0")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##rds_encrypt_data=false")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##innodb_encrypt_algorithm=aes_128_ecb")]),t._v("\n")])])]),n("ul",[n("li",[t._v("如下为docker-compose.yml文件")])]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.6")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("authentication"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("plugin=mysql_native_password\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("explicit_defaults_for_timestamp=true\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("lower_case_table_names=1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 3306"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /home/mysql/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /home/mysql/data/backup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("my.cnf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/my.cnf\n")])])]),n("ul",[n("li",[t._v("自己测试数据库的备份和恢复，包括逻辑备份以及binlog的恢复")])]),t._v(" "),n("h2",{attrs:{id:"mysqlbinlog的恢复"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysqlbinlog的恢复"}},[t._v("#")]),t._v(" mysqlbinlog的恢复")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("直接获取到的binlog的日志是通过base64加密的，需要查看的话，需要通过解密"),n("br"),t._v(" "),n("code",[t._v("mysqlbinlog --base64-output=decode-rows -v mysql-bin.000001")])])]),t._v(" "),n("li",[n("p",[t._v("通过position恢复的命令"),n("br"),t._v(" "),n("code",[t._v('mysqlbinlog --start-position="230" --stop-position="689" binlog.000004 |mysql -uroot -p')])])]),t._v(" "),n("li",[n("p",[t._v("通过时间点来进行恢复"),n("br"),t._v(" "),n("code",[t._v('mysqlbinlog --start-datetime="2019-10-24 3:21:26" --stop-datetime="2019-10-24 3:21:29" binlog.000004 |mysql -uroot -p')])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);