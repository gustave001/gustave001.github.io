<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前言 | kikfan</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css">
    <meta name="description" content="kikfan">
    
    <link rel="preload" href="/assets/css/2.styles.051e8285.css" as="style"><link rel="preload" href="/assets/js/app.27b2d4ce.js" as="script"><link rel="preload" href="/assets/js/4.9a9f6078.js" as="script"><link rel="preload" href="/assets/js/69.23fa6377.js" as="script"><link rel="prefetch" href="/assets/js/0.e4e7bdd7.js"><link rel="prefetch" href="/assets/js/1.fa961c29.js"><link rel="prefetch" href="/assets/js/10.731ee775.js"><link rel="prefetch" href="/assets/js/100.8f4b7cc5.js"><link rel="prefetch" href="/assets/js/101.a083f158.js"><link rel="prefetch" href="/assets/js/102.2c3648c3.js"><link rel="prefetch" href="/assets/js/103.f00d7dd8.js"><link rel="prefetch" href="/assets/js/104.0c414ab7.js"><link rel="prefetch" href="/assets/js/105.683675df.js"><link rel="prefetch" href="/assets/js/106.733b71a1.js"><link rel="prefetch" href="/assets/js/107.16837d98.js"><link rel="prefetch" href="/assets/js/108.28ae623b.js"><link rel="prefetch" href="/assets/js/109.a702f251.js"><link rel="prefetch" href="/assets/js/11.d7b558c8.js"><link rel="prefetch" href="/assets/js/110.74980c24.js"><link rel="prefetch" href="/assets/js/111.bf05772f.js"><link rel="prefetch" href="/assets/js/112.7f823ce5.js"><link rel="prefetch" href="/assets/js/113.4145bf66.js"><link rel="prefetch" href="/assets/js/114.4466ba9a.js"><link rel="prefetch" href="/assets/js/115.7066e3ba.js"><link rel="prefetch" href="/assets/js/116.dc1f78b7.js"><link rel="prefetch" href="/assets/js/117.88fe74db.js"><link rel="prefetch" href="/assets/js/118.e37e03b4.js"><link rel="prefetch" href="/assets/js/119.d7e4f790.js"><link rel="prefetch" href="/assets/js/12.42f2fa87.js"><link rel="prefetch" href="/assets/js/13.41e1d4b5.js"><link rel="prefetch" href="/assets/js/14.5b7e8e37.js"><link rel="prefetch" href="/assets/js/15.d9e0fc06.js"><link rel="prefetch" href="/assets/js/16.87dd9a3b.js"><link rel="prefetch" href="/assets/js/17.d120ed17.js"><link rel="prefetch" href="/assets/js/18.59184376.js"><link rel="prefetch" href="/assets/js/19.39139a03.js"><link rel="prefetch" href="/assets/js/20.2d9ec408.js"><link rel="prefetch" href="/assets/js/21.6e654bc3.js"><link rel="prefetch" href="/assets/js/22.1a060135.js"><link rel="prefetch" href="/assets/js/23.dcf0bfcc.js"><link rel="prefetch" href="/assets/js/24.9b4a4b3e.js"><link rel="prefetch" href="/assets/js/25.f57f3c65.js"><link rel="prefetch" href="/assets/js/26.fc43a3ae.js"><link rel="prefetch" href="/assets/js/27.e9aaf732.js"><link rel="prefetch" href="/assets/js/28.6e1886c7.js"><link rel="prefetch" href="/assets/js/29.ff720b7d.js"><link rel="prefetch" href="/assets/js/30.297554f4.js"><link rel="prefetch" href="/assets/js/31.fc02f056.js"><link rel="prefetch" href="/assets/js/32.978c9766.js"><link rel="prefetch" href="/assets/js/33.faa483ef.js"><link rel="prefetch" href="/assets/js/34.7f3cc871.js"><link rel="prefetch" href="/assets/js/35.62b9a752.js"><link rel="prefetch" href="/assets/js/36.c08848fc.js"><link rel="prefetch" href="/assets/js/37.59f685b7.js"><link rel="prefetch" href="/assets/js/38.c1588f41.js"><link rel="prefetch" href="/assets/js/39.fdb35fe6.js"><link rel="prefetch" href="/assets/js/40.65505803.js"><link rel="prefetch" href="/assets/js/41.54da323c.js"><link rel="prefetch" href="/assets/js/42.45bbba91.js"><link rel="prefetch" href="/assets/js/43.1f36637d.js"><link rel="prefetch" href="/assets/js/44.d7d8a539.js"><link rel="prefetch" href="/assets/js/45.7d764f0b.js"><link rel="prefetch" href="/assets/js/46.3bad6567.js"><link rel="prefetch" href="/assets/js/47.2946a535.js"><link rel="prefetch" href="/assets/js/48.85cbb854.js"><link rel="prefetch" href="/assets/js/49.315a2781.js"><link rel="prefetch" href="/assets/js/5.60a71eda.js"><link rel="prefetch" href="/assets/js/50.58a11a9c.js"><link rel="prefetch" href="/assets/js/51.ea33dd6c.js"><link rel="prefetch" href="/assets/js/52.c9f47820.js"><link rel="prefetch" href="/assets/js/53.012a446d.js"><link rel="prefetch" href="/assets/js/54.2c4f1849.js"><link rel="prefetch" href="/assets/js/55.2a967be9.js"><link rel="prefetch" href="/assets/js/56.2d46c0a0.js"><link rel="prefetch" href="/assets/js/57.c8880e0a.js"><link rel="prefetch" href="/assets/js/58.a6b007f9.js"><link rel="prefetch" href="/assets/js/59.97b9b7e5.js"><link rel="prefetch" href="/assets/js/6.afcd84ec.js"><link rel="prefetch" href="/assets/js/60.f4a784fc.js"><link rel="prefetch" href="/assets/js/61.05eed8fc.js"><link rel="prefetch" href="/assets/js/62.d95be5f8.js"><link rel="prefetch" href="/assets/js/63.c0d0a152.js"><link rel="prefetch" href="/assets/js/64.f74c6626.js"><link rel="prefetch" href="/assets/js/65.4872ba36.js"><link rel="prefetch" href="/assets/js/66.3846d75c.js"><link rel="prefetch" href="/assets/js/67.5d3c513c.js"><link rel="prefetch" href="/assets/js/68.4c28dad7.js"><link rel="prefetch" href="/assets/js/7.69deb300.js"><link rel="prefetch" href="/assets/js/70.a1673575.js"><link rel="prefetch" href="/assets/js/71.53175f3c.js"><link rel="prefetch" href="/assets/js/72.699361e6.js"><link rel="prefetch" href="/assets/js/73.683bacf8.js"><link rel="prefetch" href="/assets/js/74.d27b950a.js"><link rel="prefetch" href="/assets/js/75.30cfcf8c.js"><link rel="prefetch" href="/assets/js/76.7115ba1f.js"><link rel="prefetch" href="/assets/js/77.61f7aec4.js"><link rel="prefetch" href="/assets/js/78.d9b71b38.js"><link rel="prefetch" href="/assets/js/79.8df96305.js"><link rel="prefetch" href="/assets/js/8.b5d41094.js"><link rel="prefetch" href="/assets/js/80.caefa481.js"><link rel="prefetch" href="/assets/js/81.fbe7f1af.js"><link rel="prefetch" href="/assets/js/82.8a0c0e86.js"><link rel="prefetch" href="/assets/js/83.77f553eb.js"><link rel="prefetch" href="/assets/js/84.9d3058ad.js"><link rel="prefetch" href="/assets/js/85.d66493d7.js"><link rel="prefetch" href="/assets/js/86.d82b3465.js"><link rel="prefetch" href="/assets/js/87.ff69dfdc.js"><link rel="prefetch" href="/assets/js/88.db8a809d.js"><link rel="prefetch" href="/assets/js/89.dbae01c0.js"><link rel="prefetch" href="/assets/js/9.42dfa068.js"><link rel="prefetch" href="/assets/js/90.ac501b95.js"><link rel="prefetch" href="/assets/js/91.de4c7a0e.js"><link rel="prefetch" href="/assets/js/92.689f4272.js"><link rel="prefetch" href="/assets/js/93.17e1c4ae.js"><link rel="prefetch" href="/assets/js/94.1978b8c9.js"><link rel="prefetch" href="/assets/js/95.fb0afeb1.js"><link rel="prefetch" href="/assets/js/96.8b6541d8.js"><link rel="prefetch" href="/assets/js/97.793aa5c6.js"><link rel="prefetch" href="/assets/js/98.62b7c58e.js"><link rel="prefetch" href="/assets/js/99.54020815.js">
    <link rel="stylesheet" href="/assets/css/2.styles.051e8285.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">kikfan</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/idea/" class="nav-link">
  IDEA
</a></div><div class="nav-item"><a href="/devops/" class="nav-link">
  DevOps
</a></div><div class="nav-item"><a href="/web/" class="nav-link">
  Web
</a></div><div class="nav-item"><a href="/curiousness/" class="nav-link">
  好奇尚异
</a></div><div class="nav-item"><a href="/long-road/" class="nav-link">
  道阻且长
</a></div><div class="nav-item"><a href="/step-back/" class="nav-link">
  海阔天空
</a></div><div class="nav-item"><a href="/experience/" class="nav-link router-link-active">
  吃堑长智
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  Tools
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/idea/" class="nav-link">
  IDEA
</a></div><div class="nav-item"><a href="/devops/" class="nav-link">
  DevOps
</a></div><div class="nav-item"><a href="/web/" class="nav-link">
  Web
</a></div><div class="nav-item"><a href="/curiousness/" class="nav-link">
  好奇尚异
</a></div><div class="nav-item"><a href="/long-road/" class="nav-link">
  道阻且长
</a></div><div class="nav-item"><a href="/step-back/" class="nav-link">
  海阔天空
</a></div><div class="nav-item"><a href="/experience/" class="nav-link router-link-active">
  吃堑长智
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  Tools
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>吃堑长智</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/experience/" aria-current="page" class="sidebar-link">简介</a></li><li><a href="/experience/App 积分设计.html" class="sidebar-link">App 积分设计</a></li><li><a href="/experience/Mysql恢复.html" class="sidebar-link">Mysql恢复</a></li><li><a href="/experience/postgres全备份和增量备份.html" class="sidebar-link">postgres全备份和增量备份</a></li><li><a href="/experience/tomcat假死.html" class="sidebar-link">tomcat假死</a></li><li><a href="/experience/一叶障目，不见泰山.html" class="active sidebar-link">一叶障目，不见泰山</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#update-join" class="sidebar-link">Update Join</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#delete-join" class="sidebar-link">Delete Join</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#in-和-exists" class="sidebar-link">in 和 exists</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#not-in-和not-exists" class="sidebar-link">not in 和not exists</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#获取表中某字段包含某字符串的数据" class="sidebar-link">获取表中某字段包含某字符串的数据</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#连续范围的问题" class="sidebar-link">连续范围的问题</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#签到问题" class="sidebar-link">签到问题</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#mysql的测试表" class="sidebar-link">MySQL的测试表</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询-01-课程比-02-课程成绩高的学生的信息及课程分数" class="sidebar-link">查询&quot;01&quot;课程比&quot;02&quot;课程成绩高的学生的信息及课程分数</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询-01-课程比-02-课程成绩低的学生的信息及课程分数" class="sidebar-link">查询&quot;01&quot;课程比&quot;02&quot;课程成绩低的学生的信息及课程分数</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询平均成绩大于等于60分的同学的学生编号和学生姓名和平均成绩" class="sidebar-link">查询平均成绩大于等于60分的同学的学生编号和学生姓名和平均成绩</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询平均成绩小于60分的同学的学生编号和学生姓名和平均成绩" class="sidebar-link">查询平均成绩小于60分的同学的学生编号和学生姓名和平均成绩</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩" class="sidebar-link">查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询-李-姓老师的数量" class="sidebar-link">查询&quot;李&quot;姓老师的数量</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询学过-张三-老师授课的同学的信息" class="sidebar-link">查询学过&quot;张三&quot;老师授课的同学的信息</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询没学过-张三-老师授课的同学的信息" class="sidebar-link">查询没学过&quot;张三&quot;老师授课的同学的信息</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询学过编号为-01-并且也学过编号为-02-的课程的同学的信息" class="sidebar-link">查询学过编号为&quot;01&quot;并且也学过编号为&quot;02&quot;的课程的同学的信息</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询学过编号为-01-但是没有学过编号为-02-的课程的同学的信息" class="sidebar-link">查询学过编号为&quot;01&quot;但是没有学过编号为&quot;02&quot;的课程的同学的信息</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询没有学全所有课程的同学的信息" class="sidebar-link">查询没有学全所有课程的同学的信息</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询至少有一门课与学号为-01-的同学所学相同的同学的信息" class="sidebar-link">查询至少有一门课与学号为&quot;01&quot;的同学所学相同的同学的信息</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询和-01-号的同学学习的课程完全相同的其他同学的信息" class="sidebar-link">查询和&quot;01&quot;号的同学学习的课程完全相同的其他同学的信息</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询没学过-张三-老师讲授的任一门课程的学生姓名" class="sidebar-link">查询没学过&quot;张三&quot;老师讲授的任一门课程的学生姓名</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询两门及其以上不及格课程的同学的学号-姓名及其平均成绩" class="sidebar-link">查询两门及其以上不及格课程的同学的学号，姓名及其平均成绩</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#检索-01-课程分数小于60-按分数降序排列的学生信息" class="sidebar-link">检索&quot;01&quot;课程分数小于60，按分数降序排列的学生信息</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩" class="sidebar-link">按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询各科成绩最高分、最低分和平均分-以如下形式显示-课程id-课程name-最高分-最低分-平均分-及格率-中等率-优良率-优秀率-及格为-60-中等为-70-80-优良为-80-90-优秀为-90" class="sidebar-link">查询各科成绩最高分、最低分和平均分：以如下形式显示：课程ID，课程name，最高分，最低分，平均分，及格率，中等率，优良率，优秀率 –及格为&gt;=60，中等为：70-80，优良为：80-90，优秀为：&gt;=90</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#按各科成绩进行排序-并显示排名-实现不完全" class="sidebar-link">按各科成绩进行排序，并显示排名(实现不完全)</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询学生的总成绩并进行排名" class="sidebar-link">查询学生的总成绩并进行排名</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询不同老师所教不同课程平均分从高到低显示" class="sidebar-link">查询不同老师所教不同课程平均分从高到低显示</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询所有课程的成绩第2名到第3名的学生信息及该课程成绩" class="sidebar-link">查询所有课程的成绩第2名到第3名的学生信息及该课程成绩</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#统计各科成绩各分数段人数-课程编号-课程名称-100-85-85-70-70-60-0-60及所占百分比" class="sidebar-link">统计各科成绩各分数段人数：课程编号,课程名称,100-85,85-70,70-60,0-60及所占百分比</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询学生平均成绩及其名次" class="sidebar-link">查询学生平均成绩及其名次</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询各科成绩前三名的记录" class="sidebar-link">查询各科成绩前三名的记录</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询每门课程被重修的学生数" class="sidebar-link">查询每门课程被重修的学生数</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询出只有两门课程的全部学生的学号和姓名" class="sidebar-link">查询出只有两门课程的全部学生的学号和姓名</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询男生、女生人数" class="sidebar-link">查询男生、女生人数</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询名字中含有-风-字的学生信息" class="sidebar-link">查询名字中含有&quot;风&quot;字的学生信息</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询同名同性学生名单-并统计同名人数" class="sidebar-link">查询同名同性学生名单，并统计同名人数</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询1990年出生的学生名单" class="sidebar-link">查询1990年出生的学生名单</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询每门课程的平均成绩-结果按平均成绩降序排列-平均成绩相同时-按课程编号升序排列" class="sidebar-link">查询每门课程的平均成绩，结果按平均成绩降序排列，平均成绩相同时，按课程编号升序排列</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询平均成绩大于等于85的所有学生的学号、姓名和平均成绩" class="sidebar-link">查询平均成绩大于等于85的所有学生的学号、姓名和平均成绩</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询课程名称为-数学-且分数低于60的学生姓名和分数" class="sidebar-link">查询课程名称为&quot;数学&quot;，且分数低于60的学生姓名和分数</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询所有学生的课程及分数情况" class="sidebar-link">查询所有学生的课程及分数情况</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询任何一门课程成绩在70分以上的学生姓名、课程名称和分数" class="sidebar-link">查询任何一门课程成绩在70分以上的学生姓名、课程名称和分数</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询不及格的课程" class="sidebar-link">查询不及格的课程</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询课程编号为01且课程成绩在80分以上的学生的学号和姓名" class="sidebar-link">查询课程编号为01且课程成绩在80分以上的学生的学号和姓名</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#求每门课程的学生人数" class="sidebar-link">求每门课程的学生人数</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询选修-张三-老师所授课程的学生中-成绩最高的学生信息及其成绩" class="sidebar-link">查询选修&quot;张三&quot;老师所授课程的学生中，成绩最高的学生信息及其成绩</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩" class="sidebar-link">查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询每门课程成绩最好的前两名" class="sidebar-link">查询每门课程成绩最好的前两名</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#统计每门课程的学生选修人数-超过5人的课程才统计-。要求输出课程号和选修人数-查询结果按人数降序排列-若人数相同-按课程号升序排列" class="sidebar-link">统计每门课程的学生选修人数（超过5人的课程才统计）。要求输出课程号和选修人数，查询结果按人数降序排列，若人数相同，按课程号升序排列</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#检索至少选修两门课程的学生学号" class="sidebar-link">检索至少选修两门课程的学生学号</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询选修了全部课程的学生信息" class="sidebar-link">查询选修了全部课程的学生信息</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询各学生的年龄" class="sidebar-link">查询各学生的年龄</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询本周过生日的学生" class="sidebar-link">查询本周过生日的学生</a></li><li class="sidebar-sub-header"><a href="/experience/一叶障目，不见泰山.html#查询本月过生日的学生" class="sidebar-link">查询本月过生日的学生</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <ul><li>过于草率地相信直觉的判断了，作为一个猜想是需要验证的，想当然才是根源</li> <li>执行力不够，脑袋里产生想法之后一定要立即马上去验证，时间长了就忘了！！（最次也得上备忘录）</li> <li>对于连表的理解有欠缺</li> <li>sql语句多学多看，多查，终身学习，不要被其他的边边角角占据了头脑，保持敏锐！</li> <li>对于where in和inner join，not in 和left join之间的转化关系有进一步了解</li> <li>前几名的问题，使用group_concat 和 find_in_set的形式可以方便地解决问题</li> <li>周的生日的问题，年份必须转化，不然只会是错误的结果</li> <li>case when 的用法，常见于行和列的转化</li> <li>MySQL里没有排名函数，所以使用定义的方式就尤为重要，尤其是不保留排名的方式，必须要3个变量</li></ul> <h2 id="update-join"><a href="#update-join" class="header-anchor">#</a> Update Join</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> table_name_1
<span class="token keyword">inner</span> <span class="token keyword">join</span> table_name_2 <span class="token keyword">on</span> table_name_1<span class="token punctuation">.</span>id <span class="token operator">=</span> table_name_2<span class="token punctuation">.</span>uid
<span class="token keyword">inner</span> <span class="token keyword">join</span> table_name_3 <span class="token keyword">on</span> table_name_3<span class="token punctuation">.</span>id <span class="token operator">=</span> table_name_1<span class="token punctuation">.</span>tid
<span class="token keyword">set</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token keyword">where</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
</code></pre></div><h2 id="delete-join"><a href="#delete-join" class="header-anchor">#</a> Delete Join</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DELETE</span> a <span class="token keyword">FROM</span> t1 a <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">min</span><span class="token punctuation">(</span>info_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> infoId
<span class="token keyword">FROM</span> t1
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> form_id<span class="token punctuation">)</span> b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>info_id <span class="token operator">=</span> b<span class="token punctuation">.</span>infoId <span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>infoId <span class="token operator">is</span> <span class="token boolean">NULL</span>
</code></pre></div><h2 id="in-和-exists"><a href="#in-和-exists" class="header-anchor">#</a> in 和 exists</h2> <p>in是把外表和内表作hash连接，而exists是对外表作loop循环，每次loop循环再对内表进行查询，一直以来认为exists比in效率高的说法是不准确的。如果查询的两个表大小相当，那么用in和exists差别不大；如果两个表中一个较小一个较大，则子查询表大的用exists，子查询表小的用in；</p> <p>例如：表A(小表)，表B(大表)</p> <p>select * from A where cc in(select cc from B)　　--&gt;效率低，用到了A表上cc列的索引；</p> <p>select * from A where exists(select cc from B where cc=A.cc)　　--&gt;效率高，用到了B表上cc列的索引。<br>
相反的：</p> <p>select * from B where cc in(select cc from A)　　--&gt;效率高，用到了B表上cc列的索引</p> <p>select * from B where exists(select cc from A where cc=B.cc)　　--&gt;效率低，用到了A表上cc列的索引。</p> <h2 id="not-in-和not-exists"><a href="#not-in-和not-exists" class="header-anchor">#</a> not in 和not exists</h2> <p>not in 逻辑上不完全等同于not exists，如果你误用了not in，小心你的程序存在致命的BUG，请看下面的例子：</p> <p>create table ##t1(c1 int,c2 int);</p> <p>create table ##t2(c1 int,c2 int);</p> <p>insert into ##t1 values(1,2);</p> <p>insert into ##t1 values(1,3);</p> <p>insert into ##t2 values(1,2);</p> <p>insert into ##t2 values(1,null);</p> <p>select * from ##t1 where c2 not in(select c2 from ##t2);　　--&gt;执行结果：无</p> <p>select * from ##t1 where not exists(select 1 from ##t2 where ##t2.c2=##t1.c2)　　--&gt;执行结果：1　　3</p> <p>正如所看到的，not in出现了不期望的结果集，存在逻辑错误。如果看一下上述两个select 语句的执行计划，也会不同，后者使用了hash_aj，所以，请尽量不要使用not in(它会调用子查询)，而尽量使用not exists（它会调用关联子查询）。如果子查询中返回的任意一条记录含有空值，则查询将不返回任何记录。如果子查询字段有非空限制，这时可以使用not in，并且可以通过提示让它用hasg_aj或merge_aj连接。</p> <p>如果查询语句使用了not in，那么对内外表都进行全表扫描，没有用到索引；而not exists的子查询依然能用到表上的索引。所以无论哪个表大，用not exists都比not in 要快。</p> <ul><li>说多了都是泪啊</li></ul> <h2 id="获取表中某字段包含某字符串的数据"><a href="#获取表中某字段包含某字符串的数据" class="header-anchor">#</a> 获取表中某字段包含某字符串的数据</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>表名<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> LOCATE<span class="token punctuation">(</span><span class="token string">'关键字'</span><span class="token punctuation">,</span> 字段名<span class="token punctuation">)</span>
</code></pre></div><ul><li>locate函数的用法</li></ul> <h2 id="连续范围的问题"><a href="#连续范围的问题" class="header-anchor">#</a> 连续范围的问题</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">## 创建测试表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>test_number<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>number<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'数字'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>


<span class="token comment">## 创建测试数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test_number <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test_number <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test_number <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test_number <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test_number <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test_number <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test_number <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test_number <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token function">min</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> start_range<span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> end_range
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> number<span class="token punctuation">,</span> rn<span class="token punctuation">,</span> number <span class="token operator">-</span> rn diff
      <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> number<span class="token punctuation">,</span> <span class="token variable">@number</span> :<span class="token operator">=</span> <span class="token variable">@number</span> <span class="token operator">+</span> <span class="token number">1</span> rn
            <span class="token keyword">FROM</span> test_number<span class="token punctuation">,</span>
                 <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@number</span> :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> number<span class="token punctuation">)</span> b<span class="token punctuation">)</span> c
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> diff<span class="token punctuation">;</span>
</code></pre></div><h2 id="签到问题"><a href="#签到问题" class="header-anchor">#</a> 签到问题</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">## 创建参考表(模拟数据需要用到)</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>test_nums<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'参考表'</span><span class="token punctuation">;</span>
<span class="token comment">## 模拟数据，插入 1-1000 连续数据.</span>
<span class="token keyword">create</span> <span class="token keyword">PROCEDURE</span> test<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">BEGIN</span>
    <span class="token keyword">DECLARE</span> i <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">WHILE</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token keyword">DO</span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_nums <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
  <span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token keyword">CALL</span> test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> test<span class="token punctuation">;</span>

<span class="token comment">## 创建测试表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>test_sign_history<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>uid<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户ID'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'签到时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'签到历史表'</span><span class="token punctuation">;</span>

<span class="token comment">## 创建测试数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test_sign_history<span class="token punctuation">(</span>uid<span class="token punctuation">,</span>create_time<span class="token punctuation">)</span>
<span class="token keyword">select</span> ceil<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>str_to_date<span class="token punctuation">(</span><span class="token string">'2016-12-11'</span><span class="token punctuation">,</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token keyword">interval</span> ceil<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token keyword">minute</span>
<span class="token keyword">from</span> test_nums <span class="token keyword">where</span> id<span class="token operator">&lt;</span><span class="token number">500</span><span class="token punctuation">;</span>

<span class="token comment">## 统计每天的每小时用户签到情况</span>
<span class="token keyword">SELECT</span>
       tmp<span class="token punctuation">.</span>h<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> tmp<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'20161211'</span> <span class="token keyword">THEN</span> tmp<span class="token punctuation">.</span>c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">11</span>sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> tmp<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'20161212'</span> <span class="token keyword">THEN</span> tmp<span class="token punctuation">.</span>c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">12</span>sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> tmp<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'20161213'</span> <span class="token keyword">THEN</span> tmp<span class="token punctuation">.</span>c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">13</span>sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> tmp<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'20161214'</span> <span class="token keyword">THEN</span> tmp<span class="token punctuation">.</span>c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">14</span>sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> tmp<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'20161215'</span> <span class="token keyword">THEN</span> tmp<span class="token punctuation">.</span>c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">15</span>sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> tmp<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'20161216'</span> <span class="token keyword">THEN</span> tmp<span class="token punctuation">.</span>c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">16</span>sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> tmp<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'20161217'</span> <span class="token keyword">THEN</span> tmp<span class="token punctuation">.</span>c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">17</span>sign
<span class="token keyword">FROM</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">hour</span><span class="token punctuation">(</span>create_time<span class="token punctuation">)</span> h<span class="token punctuation">,</span>date_format<span class="token punctuation">(</span>create_time<span class="token punctuation">,</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> d<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> c
<span class="token keyword">FROM</span> test_sign_history <span class="token keyword">group</span> <span class="token keyword">BY</span> h<span class="token punctuation">,</span>d<span class="token punctuation">)</span> tmp
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> tmp<span class="token punctuation">.</span>h <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> tmp<span class="token punctuation">.</span>h<span class="token punctuation">;</span>

<span class="token comment">## 统计每天的每小时用户签到情况(当某个小时没有数据时，显示0)</span>
<span class="token comment">## 主要在于使用了辅助表，使用它用来作为left join 的主表</span>
<span class="token keyword">SELECT</span>
       tmp<span class="token punctuation">.</span>h<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> tmp<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'20161211'</span> <span class="token keyword">THEN</span> tmp<span class="token punctuation">.</span>c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">11</span>sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> tmp<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'20161212'</span> <span class="token keyword">THEN</span> tmp<span class="token punctuation">.</span>c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">12</span>sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> tmp<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'20161213'</span> <span class="token keyword">THEN</span> tmp<span class="token punctuation">.</span>c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">13</span>sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> tmp<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'20161214'</span> <span class="token keyword">THEN</span> tmp<span class="token punctuation">.</span>c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">14</span>sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> tmp<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'20161215'</span> <span class="token keyword">THEN</span> tmp<span class="token punctuation">.</span>c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">15</span>sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> tmp<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'20161216'</span> <span class="token keyword">THEN</span> tmp<span class="token punctuation">.</span>c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">16</span>sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> tmp<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'20161217'</span> <span class="token keyword">THEN</span> tmp<span class="token punctuation">.</span>c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">17</span>sign
<span class="token keyword">FROM</span>
     <span class="token punctuation">(</span><span class="token keyword">SELECT</span> b<span class="token punctuation">.</span>h<span class="token punctuation">,</span>tsh<span class="token punctuation">.</span>d<span class="token punctuation">,</span>tsh<span class="token punctuation">.</span>c
     <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> id <span class="token keyword">as</span> h <span class="token keyword">FROM</span> test_nums <span class="token keyword">WHERE</span> id <span class="token operator">&lt;=</span> <span class="token number">24</span><span class="token punctuation">)</span> b
     <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span>
     <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">hour</span><span class="token punctuation">(</span>create_time<span class="token punctuation">)</span> h<span class="token punctuation">,</span>date_format<span class="token punctuation">(</span>create_time<span class="token punctuation">,</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> d<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> c
      <span class="token keyword">FROM</span> test_sign_history <span class="token keyword">group</span> <span class="token keyword">BY</span> h<span class="token punctuation">,</span>d<span class="token punctuation">)</span> tsh <span class="token keyword">ON</span> b<span class="token punctuation">.</span>h <span class="token operator">=</span> tsh<span class="token punctuation">.</span>h
     <span class="token punctuation">)</span> tmp
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> tmp<span class="token punctuation">.</span>h <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> tmp<span class="token punctuation">.</span>h<span class="token punctuation">;</span>

<span class="token comment">## 统计每天的用户签到数据和每天的增量数据</span>
<span class="token comment">## 自己想的写法</span>
<span class="token keyword">SELECT</span> t<span class="token punctuation">.</span>d<span class="token punctuation">,</span> t<span class="token punctuation">.</span>cnt<span class="token punctuation">,</span> t<span class="token punctuation">.</span>cnt <span class="token operator">-</span> <span class="token variable">@rown</span> <span class="token keyword">AS</span> increase<span class="token punctuation">,</span> <span class="token variable">@rown</span> :<span class="token operator">=</span> t<span class="token punctuation">.</span>cnt
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> date_format<span class="token punctuation">(</span>create_time<span class="token punctuation">,</span> <span class="token string">'%Y%m%d'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> d<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> cnt
            <span class="token keyword">FROM</span> test_sign_history
      <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> d
      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> d<span class="token punctuation">)</span> t<span class="token punctuation">,</span>
     <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@rown</span> :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> r<span class="token punctuation">;</span>

<span class="token comment">## 参考写法</span>
<span class="token comment">## 两种写法，思想不同而已</span>
<span class="token keyword">SELECT</span> <span class="token keyword">type</span><span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> create_time <span class="token operator">=</span> <span class="token string">'2016-12-11'</span> <span class="token keyword">THEN</span> c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token number">11</span>Sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> create_time <span class="token operator">=</span> <span class="token string">'2016-12-12'</span> <span class="token keyword">THEN</span> c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token number">12</span>Sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> create_time <span class="token operator">=</span> <span class="token string">'2016-12-13'</span> <span class="token keyword">THEN</span> c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token number">13</span>Sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> create_time <span class="token operator">=</span> <span class="token string">'2016-12-14'</span> <span class="token keyword">THEN</span> c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token number">14</span>Sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> create_time <span class="token operator">=</span> <span class="token string">'2016-12-15'</span> <span class="token keyword">THEN</span> c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token number">15</span>Sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> create_time <span class="token operator">=</span> <span class="token string">'2016-12-16'</span> <span class="token keyword">THEN</span> c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token number">16</span>Sign<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> create_time <span class="token operator">=</span> <span class="token string">'2016-12-17'</span> <span class="token keyword">THEN</span> c <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token number">17</span>Sign
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> b<span class="token punctuation">.</span>create_time<span class="token punctuation">,</span> ifnull<span class="token punctuation">(</span>b<span class="token punctuation">.</span>c <span class="token operator">-</span> c<span class="token punctuation">.</span>c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> c<span class="token punctuation">,</span> <span class="token string">'Increment'</span> <span class="token keyword">type</span>
      <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> date_format<span class="token punctuation">(</span>create_time<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span> create_time<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> c
            <span class="token keyword">FROM</span> test_sign_history
            <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> date_format<span class="token punctuation">(</span>create_time<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> b
             <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> date_format<span class="token punctuation">(</span>create_time<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span> create_time<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> c
                        <span class="token keyword">FROM</span> test_sign_history
                        <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> date_format<span class="token punctuation">(</span>create_time<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> c
               <span class="token keyword">ON</span> <span class="token punctuation">(</span>b<span class="token punctuation">.</span>create_time <span class="token operator">=</span> c<span class="token punctuation">.</span>create_time <span class="token operator">+</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span>
      <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
      <span class="token keyword">SELECT</span> date_format<span class="token punctuation">(</span>create_time<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span> create_time<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> c<span class="token punctuation">,</span> <span class="token string">'Current'</span>
      <span class="token keyword">FROM</span> test_sign_history
      <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> date_format<span class="token punctuation">(</span>create_time<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> a
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">type</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'Current'</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span>


<span class="token comment">##模拟不同的用户签到了不同的天数</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test_sign_history<span class="token punctuation">(</span>uid<span class="token punctuation">,</span>create_time<span class="token punctuation">)</span>
<span class="token keyword">select</span> uid<span class="token punctuation">,</span>create_time <span class="token operator">+</span> <span class="token keyword">interval</span> ceil<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">day</span> <span class="token keyword">from</span> test_sign_history<span class="token punctuation">,</span>test_nums
<span class="token keyword">where</span> test_nums<span class="token punctuation">.</span>id <span class="token operator">&lt;</span><span class="token number">10</span> <span class="token keyword">order</span> <span class="token keyword">by</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">limit</span> <span class="token number">150</span><span class="token punctuation">;</span>

<span class="token comment">## 统计签到天数相同的用户数量</span>
<span class="token keyword">SELECT</span> date_format<span class="token punctuation">(</span>create_time<span class="token punctuation">,</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> d<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> uid<span class="token punctuation">)</span> <span class="token keyword">AS</span> user_cnt
<span class="token keyword">FROM</span> test_sign_history <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> d <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> d<span class="token punctuation">;</span>

<span class="token comment">## 统计每个用户的连续签到时间</span>
<span class="token comment">## 属于连续问题的解决办法</span>
<span class="token keyword">SELECT</span> tmp2<span class="token punctuation">.</span>uid<span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>tmp2<span class="token punctuation">.</span>sign_last<span class="token punctuation">)</span> <span class="token keyword">FROM</span>
       <span class="token punctuation">(</span>
       <span class="token keyword">SELECT</span> tmp<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token keyword">AS</span> begin_date<span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token keyword">AS</span> end_date<span class="token punctuation">,</span> datediff<span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token keyword">AS</span> sign_last
        <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> ud<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> ud<span class="token punctuation">.</span>d<span class="token punctuation">,</span> datediff<span class="token punctuation">(</span>ud<span class="token punctuation">.</span>d<span class="token punctuation">,</span> <span class="token variable">@time</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> diff<span class="token punctuation">,</span> <span class="token variable">@time</span> :<span class="token operator">=</span> <span class="token variable">@time</span> <span class="token operator">+</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span>
              <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> uid<span class="token punctuation">,</span> date_format<span class="token punctuation">(</span>create_time<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> d
                    <span class="token keyword">FROM</span> test_sign_history
                    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> uid<span class="token punctuation">,</span> d
                    <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> uid<span class="token punctuation">,</span> d<span class="token punctuation">)</span> ud<span class="token punctuation">,</span>
                   <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@time</span> :<span class="token operator">=</span> <span class="token string">'2016-01-01'</span><span class="token punctuation">)</span> t<span class="token punctuation">)</span> tmp
        <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> tmp<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> tmp<span class="token punctuation">.</span>diff
       <span class="token punctuation">)</span> tmp2 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> tmp2<span class="token punctuation">.</span>uid<span class="token punctuation">;</span>

<span class="token comment">## 参考写法</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> d<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token variable">@ggid</span> :<span class="token operator">=</span> <span class="token variable">@cggid</span><span class="token punctuation">,</span> <span class="token variable">@cggid</span> :<span class="token operator">=</span> d<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">@ggid</span> <span class="token operator">=</span> <span class="token variable">@cggid</span><span class="token punctuation">,</span> <span class="token variable">@grank</span> :<span class="token operator">=</span> <span class="token variable">@grank</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">@grank</span> :<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> grank
      <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> uid<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>create_time<span class="token punctuation">)</span> begin_date<span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>create_time<span class="token punctuation">)</span> end_date<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> count
            <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> b<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>
                         <span class="token variable">@gid</span> :<span class="token operator">=</span> <span class="token variable">@cgid</span><span class="token punctuation">,</span>
                         <span class="token variable">@cgid</span> :<span class="token operator">=</span> b<span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
                         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">@gid</span> <span class="token operator">=</span> <span class="token variable">@cgid</span><span class="token punctuation">,</span> <span class="token variable">@rank</span> :<span class="token operator">=</span> <span class="token variable">@rank</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">@rank</span> :<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         b<span class="token punctuation">.</span>diff <span class="token operator">-</span> <span class="token variable">@rank</span> <span class="token keyword">as</span> flag
                  <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> uid<span class="token punctuation">,</span>
                                        date_format<span class="token punctuation">(</span>create_time<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span> create_time<span class="token punctuation">,</span>
                                        datediff<span class="token punctuation">(</span>create_time<span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>         diff
                        <span class="token keyword">FROM</span> test_sign_history
                        <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> uid<span class="token punctuation">,</span> create_time<span class="token punctuation">)</span> b<span class="token punctuation">,</span>
                       <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@gid</span> :<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">@cgid</span> :<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">@rank</span> :<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> a<span class="token punctuation">)</span> c
            <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> uid<span class="token punctuation">,</span> flag
            <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> uid<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><span class="token punctuation">)</span> d<span class="token punctuation">,</span>
           <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token variable">@ggid</span> :<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">@cggid</span> :<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">@grank</span> :<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> e<span class="token punctuation">)</span>f
<span class="token keyword">WHERE</span> grank <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

</code></pre></div><p><a href="https://blog.csdn.net/Thomson617/article/details/83140926" target="_blank" rel="noopener noreferrer">MySQL2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="mysql的测试表"><a href="#mysql的测试表" class="header-anchor">#</a> MySQL的测试表</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> student<span class="token punctuation">(</span>
  s_id <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  s_name <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">,</span>
  s_birth <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">,</span>
  s_sex <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>s_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> course<span class="token punctuation">(</span>
  c_id <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  c_name <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">,</span>
  t_id <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span> c_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> teacher<span class="token punctuation">(</span>
  t_id <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  t_name <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>t_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> score<span class="token punctuation">(</span>
  s_id <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  c_id <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  s_score <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>s_id<span class="token punctuation">,</span>c_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> Student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'01'</span> <span class="token punctuation">,</span> <span class="token string">'赵雷'</span> <span class="token punctuation">,</span> <span class="token string">'1990-01-01'</span> <span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'02'</span> <span class="token punctuation">,</span> <span class="token string">'钱电'</span> <span class="token punctuation">,</span> <span class="token string">'1990-12-21'</span> <span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'03'</span> <span class="token punctuation">,</span> <span class="token string">'孙风'</span> <span class="token punctuation">,</span> <span class="token string">'1990-05-20'</span> <span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'04'</span> <span class="token punctuation">,</span> <span class="token string">'李云'</span> <span class="token punctuation">,</span> <span class="token string">'1990-08-06'</span> <span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'05'</span> <span class="token punctuation">,</span> <span class="token string">'周梅'</span> <span class="token punctuation">,</span> <span class="token string">'1991-12-01'</span> <span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'06'</span> <span class="token punctuation">,</span> <span class="token string">'吴兰'</span> <span class="token punctuation">,</span> <span class="token string">'1992-03-01'</span> <span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'07'</span> <span class="token punctuation">,</span> <span class="token string">'郑竹'</span> <span class="token punctuation">,</span> <span class="token string">'1989-07-01'</span> <span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'08'</span> <span class="token punctuation">,</span> <span class="token string">'王菊'</span> <span class="token punctuation">,</span> <span class="token string">'1990-01-20'</span> <span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> Course <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'01'</span> <span class="token punctuation">,</span> <span class="token string">'语文'</span> <span class="token punctuation">,</span> <span class="token string">'02'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Course <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'02'</span> <span class="token punctuation">,</span> <span class="token string">'数学'</span> <span class="token punctuation">,</span> <span class="token string">'01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Course <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'03'</span> <span class="token punctuation">,</span> <span class="token string">'英语'</span> <span class="token punctuation">,</span> <span class="token string">'03'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> Teacher <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'01'</span> <span class="token punctuation">,</span> <span class="token string">'张三'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Teacher <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'02'</span> <span class="token punctuation">,</span> <span class="token string">'李四'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Teacher <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'03'</span> <span class="token punctuation">,</span> <span class="token string">'王五'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'01'</span> <span class="token punctuation">,</span> <span class="token string">'01'</span> <span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'01'</span> <span class="token punctuation">,</span> <span class="token string">'02'</span> <span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'01'</span> <span class="token punctuation">,</span> <span class="token string">'03'</span> <span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'02'</span> <span class="token punctuation">,</span> <span class="token string">'01'</span> <span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'02'</span> <span class="token punctuation">,</span> <span class="token string">'02'</span> <span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'02'</span> <span class="token punctuation">,</span> <span class="token string">'03'</span> <span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'03'</span> <span class="token punctuation">,</span> <span class="token string">'01'</span> <span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'03'</span> <span class="token punctuation">,</span> <span class="token string">'02'</span> <span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'03'</span> <span class="token punctuation">,</span> <span class="token string">'03'</span> <span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'04'</span> <span class="token punctuation">,</span> <span class="token string">'01'</span> <span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'04'</span> <span class="token punctuation">,</span> <span class="token string">'02'</span> <span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'04'</span> <span class="token punctuation">,</span> <span class="token string">'03'</span> <span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'05'</span> <span class="token punctuation">,</span> <span class="token string">'01'</span> <span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'05'</span> <span class="token punctuation">,</span> <span class="token string">'02'</span> <span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'06'</span> <span class="token punctuation">,</span> <span class="token string">'01'</span> <span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'06'</span> <span class="token punctuation">,</span> <span class="token string">'03'</span> <span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'07'</span> <span class="token punctuation">,</span> <span class="token string">'02'</span> <span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> Score <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'07'</span> <span class="token punctuation">,</span> <span class="token string">'03'</span> <span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="查询-01-课程比-02-课程成绩高的学生的信息及课程分数"><a href="#查询-01-课程比-02-课程成绩高的学生的信息及课程分数" class="header-anchor">#</a> 查询&quot;01&quot;课程比&quot;02&quot;课程成绩高的学生的信息及课程分数</h2> <ul><li>考虑02课程没选的的情况<br>
SELECT<br>
s.*,sc.s_score AS 01score,sc2.s_score AS 02score<br>
FROM student s INNER JOIN score sc ON s.s_id = sc.s_id AND sc.c_id = '01'<br>
LEFT JOIN score sc2 ON s.s_id = sc2.s_id AND sc2.c_id = '02'<br>
WHERE sc.s_score &lt; sc2.s_score OR sc.s_score is NULL ;</li></ul> <p>SELECT student.*, a.s_score AS 01_score, b.s_score AS 02_score<br>
FROM student<br>
JOIN score a ON student.s_id = a.s_id AND a.c_id = '01'<br>
LEFT JOIN score b ON student.s_id = b.s_id AND b.c_id = '02' OR b.c_id = NULL<br>
WHERE a.s_score &gt; b.s_score;</p> <h2 id="查询-01-课程比-02-课程成绩低的学生的信息及课程分数"><a href="#查询-01-课程比-02-课程成绩低的学生的信息及课程分数" class="header-anchor">#</a> 查询&quot;01&quot;课程比&quot;02&quot;课程成绩低的学生的信息及课程分数</h2> <p>SELECT student.*, a.s_score AS 01_score, b.s_score AS 02_score<br>
FROM student<br>
JOIN score a ON student.s_id = a.s_id AND a.c_id = '01' OR a.c_id = NULL<br>
LEFT JOIN score b ON student.s_id = b.s_id AND b.c_id = '02'<br>
WHERE a.s_score &lt; b.s_score;</p> <h2 id="查询平均成绩大于等于60分的同学的学生编号和学生姓名和平均成绩"><a href="#查询平均成绩大于等于60分的同学的学生编号和学生姓名和平均成绩" class="header-anchor">#</a> 查询平均成绩大于等于60分的同学的学生编号和学生姓名和平均成绩</h2> <ul><li>group by 之后，如果已经group by 了用以区分的id,那么其他所有的属性都是可以直接得出来的<br>
SELECT<br>
s.s_id,s.s_name,round(avg(sc.s_score),1) as avg_score<br>
FROM student s LEFT JOIN score sc on s.s_id = sc.s_id<br>
GROUP BY s.s_id,s.s_name HAVING avg(sc.s_score) &gt;= 60;</li></ul> <p>SELECT student.s_id, student.s_name, tmp.avg_score<br>
FROM student<br>
JOIN (SELECT score.s_id, round(avg(score.s_score), 1)AS avg_score FROM score GROUP BY s_id)AS tmp<br>
ON tmp.avg_score &gt;= 60<br>
WHERE student.s_id = tmp.s_id;</p> <p>–答案2</p> <p>SELECT student.s_id, student.s_name, round(avg(score.s_score), 1) AS avg_score<br>
FROM student<br>
JOIN score ON student.s_id = score.s_id<br>
GROUP BY score.s_id<br>
HAVING avg(score.s_score) &gt;= 60;</p> <h2 id="查询平均成绩小于60分的同学的学生编号和学生姓名和平均成绩"><a href="#查询平均成绩小于60分的同学的学生编号和学生姓名和平均成绩" class="header-anchor">#</a> 查询平均成绩小于60分的同学的学生编号和学生姓名和平均成绩</h2> <p>– (包括有成绩的和无成绩的)<br>
SELECT<br>
s.s_id,s.s_name,ifnull(round(avg(sc.s_score),1),0) as avg_score<br>
FROM student s LEFT JOIN score sc on s.s_id = sc.s_id<br>
GROUP BY s.s_id,s.s_name HAVING avg(sc.s_score) &lt; 60<br>
or count(sc.s_score) = 0;</p> <p>SELECT student.s_id, student.s_name, tmp.avg_score<br>
FROM student<br>
JOIN (SELECT score.s_id, round(avg(score.s_score), 1)AS avg_score FROM score GROUP BY s_id)AS tmp<br>
ON tmp.avg_score &lt; 60<br>
WHERE student.s_id = tmp.s_id<br>
UNION<br>
SELECT s_id, s_name, 0 AS avg_score<br>
FROM student<br>
WHERE s_id NOT IN<br>
(SELECT DISTINCT s_id FROM score);</p> <p>–答案2</p> <p>SELECT student.s_id, student.s_name, round(avg(score.s_score), 1) AS avg_score<br>
FROM student<br>
JOIN score ON student.s_id = score.s_id<br>
GROUP BY score.s_id<br>
HAVING avg(score.s_score) &lt; 60<br>
UNION<br>
SELECT s_id, s_name, 0 AS avg_score<br>
FROM student<br>
WHERE s_id NOT IN<br>
(SELECT DISTINCT s_id FROM score);</p> <h2 id="查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩"><a href="#查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩" class="header-anchor">#</a> 查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩</h2> <p>SELECT  s.s_id,s.s_name,count(DISTINCT sc.c_id) as num,sum(sc.s_score) as total<br>
FROM student s LEFT JOIN score sc ON s.s_id = sc.s_id<br>
GROUP BY s.s_id ORDER BY total DESC ;</p> <p>SELECT student.s_id, student.s_name, count(score.c_id) AS total_count, sum(score.s_score)AS total_score<br>
FROM student<br>
LEFT JOIN score ON student.s_id = score.s_id<br>
GROUP BY student.s_id ORDER BY total_score DESC ;</p> <h2 id="查询-李-姓老师的数量"><a href="#查询-李-姓老师的数量" class="header-anchor">#</a> 查询&quot;李&quot;姓老师的数量</h2> <p>SELECT count(1)<br>
FROM teacher<br>
WHERE t_name LIKE '李%';</p> <h2 id="查询学过-张三-老师授课的同学的信息"><a href="#查询学过-张三-老师授课的同学的信息" class="header-anchor">#</a> 查询学过&quot;张三&quot;老师授课的同学的信息</h2> <p>-- 这就是因为对于连表的概念还不够融汇贯通的表现<br>
SELECT student.*<br>
FROM student INNER JOIN<br>
(SELECT sc.s_id<br>
FROM score sc INNER JOIN course c ON sc.c_id = c.c_id<br>
INNER JOIN teacher t ON c.t_id = t.t_id WHERE t.t_name= '张三') tmp<br>
ON student.s_id = tmp.s_id;</p> <p>SELECT student.*<br>
FROM student INNER JOIN<br>
score sc ON student.s_id = sc.s_id INNER JOIN course c ON sc.c_id = c.c_id<br>
INNER JOIN teacher t ON c.t_id = t.t_id WHERE t.t_name= '张三';</p> <p>SELECT *<br>
FROM student<br>
JOIN score ON student.s_id = score.s_id<br>
WHERE score.c_id IN (SELECT course.c_id<br>
FROM course<br>
WHERE course.t_id IN (SELECT teacher.t_id FROM teacher WHERE teacher.t_name = '张三'));</p> <p>–答案2</p> <p>SELECT student.*<br>
FROM student<br>
JOIN score ON student.s_id = score.s_id<br>
JOIN course ON course.c_id = score.c_id<br>
JOIN teacher ON course.t_id = teacher.t_id AND t_name = '张三';</p> <h2 id="查询没学过-张三-老师授课的同学的信息"><a href="#查询没学过-张三-老师授课的同学的信息" class="header-anchor">#</a> 查询没学过&quot;张三&quot;老师授课的同学的信息</h2> <p>SELECT *<br>
FROM student<br>
WHERE s_id NOT IN (SELECT score.s_id<br>
FROM score<br>
WHERE score.c_id IN (SELECT course.c_id<br>
FROM course<br>
WHERE course.t_id =<br>
(SELECT teacher.t_id FROM teacher WHERE teacher.t_name = '张三')));</p> <p>SELECT student.*<br>
FROM student LEFT JOIN<br>
(SELECT sc.s_id<br>
FROM score sc INNER JOIN course c ON sc.c_id = c.c_id<br>
INNER JOIN teacher t ON c.t_id = t.t_id WHERE t.t_name= '张三') tmp<br>
ON student.s_id = tmp.s_id WHERE tmp.s_id is NULL ;</p> <p>–答案2</p> <p>SELECT student.*<br>
FROM student<br>
LEFT JOIN (SELECT s_id<br>
FROM score<br>
JOIN course ON course.c_id = score.c_id<br>
JOIN teacher ON course.t_id = teacher.t_id AND t_name = '张三')tmp ON student.s_id = tmp.s_id<br>
WHERE tmp.s_id IS NULL;</p> <h2 id="查询学过编号为-01-并且也学过编号为-02-的课程的同学的信息"><a href="#查询学过编号为-01-并且也学过编号为-02-的课程的同学的信息" class="header-anchor">#</a> 查询学过编号为&quot;01&quot;并且也学过编号为&quot;02&quot;的课程的同学的信息</h2> <p>SELECT *<br>
FROM student<br>
WHERE s_id IN (SELECT s_id FROM score WHERE c_id = 1)<br>
AND s_id IN (SELECT s_id FROM score WHERE c_id = 2);</p> <h2 id="查询学过编号为-01-但是没有学过编号为-02-的课程的同学的信息"><a href="#查询学过编号为-01-但是没有学过编号为-02-的课程的同学的信息" class="header-anchor">#</a> 查询学过编号为&quot;01&quot;但是没有学过编号为&quot;02&quot;的课程的同学的信息</h2> <p>SELECT *<br>
FROM student<br>
WHERE s_id IN (SELECT s_id FROM score WHERE c_id = 1)<br>
AND s_id NOT IN (SELECT s_id FROM score WHERE c_id = 2);</p> <p>–答案2</p> <p>SELECT student.*<br>
FROM student<br>
JOIN (SELECT s_id FROM score WHERE c_id = 1)tmp1 ON student.s_id = tmp1.s_id<br>
LEFT JOIN (SELECT s_id FROM score WHERE c_id = 2)tmp2 ON student.s_id = tmp2.s_id<br>
WHERE tmp2.s_id IS NULL;</p> <h2 id="查询没有学全所有课程的同学的信息"><a href="#查询没有学全所有课程的同学的信息" class="header-anchor">#</a> 查询没有学全所有课程的同学的信息</h2> <p>SELECT *<br>
FROM student<br>
WHERE s_id NOT IN (SELECT s_id FROM score GROUP BY s_id HAVING count(c_id) = (SELECT count(1) FROM course));</p> <h2 id="查询至少有一门课与学号为-01-的同学所学相同的同学的信息"><a href="#查询至少有一门课与学号为-01-的同学所学相同的同学的信息" class="header-anchor">#</a> 查询至少有一门课与学号为&quot;01&quot;的同学所学相同的同学的信息</h2> <p>-- 对于这种单个的条件的情况下，使用where in的方式，明显更加直接，如果有多个条件的情况下，使用join才是优势<br>
SELECT DISTINCT student.* FROM student INNER JOIN score ON student.s_id = score.s_id WHERE score.c_id IN<br>
(SELECT c_id FROM score WHERE s_id = '01') AND student.s_id &lt;&gt; '01';</p> <p>SELECT *<br>
FROM student<br>
WHERE s_id &lt;&gt; 01<br>
AND s_id IN (SELECT s_id FROM score WHERE c_id IN (SELECT c_id FROM score WHERE score.s_id = 01) GROUP BY s_id);</p> <h2 id="查询和-01-号的同学学习的课程完全相同的其他同学的信息"><a href="#查询和-01-号的同学学习的课程完全相同的其他同学的信息" class="header-anchor">#</a> 查询和&quot;01&quot;号的同学学习的课程完全相同的其他同学的信息</h2> <p>-- 使用了group_concat的知识，还以为能有什么新鲜的<br>
SELECT s.*,tmp1.cids FROM student s INNER JOIN<br>
(SELECT s_id,group_concat(c_id ORDER by c_id) as cids FROM score GROUP BY s_id ) tmp1<br>
ON s.s_id = tmp1.s_id AND s.s_id &lt;&gt; '01'<br>
WHERE tmp1.cids =<br>
(SELECT group_concat(c_id ORDER by c_id) as cids FROM score WHERE s_id = '01' GROUP BY s_id );</p> <p>SELECT student.*, tmp.course_id<br>
FROM (SELECT s_id, group_concat(c_id) course_id<br>
FROM score<br>
GROUP BY s_id<br>
HAVING s_id &lt;&gt; 1<br>
AND course_id = (SELECT group_concat(c_id) course_id2 FROM score WHERE s_id = 1))tmp<br>
JOIN student ON student.s_id = tmp.s_id;</p> <h2 id="查询没学过-张三-老师讲授的任一门课程的学生姓名"><a href="#查询没学过-张三-老师讲授的任一门课程的学生姓名" class="header-anchor">#</a> 查询没学过&quot;张三&quot;老师讲授的任一门课程的学生姓名</h2> <p>SELECT *<br>
FROM student<br>
WHERE s_id NOT IN (SELECT s_id<br>
FROM score<br>
JOIN (SELECT c_id FROM course WHERE t_id IN (SELECT t_id FROM teacher WHERE t_name = '张三'))tmp<br>
ON score.c_id = tmp.c_id);</p> <p>–答案2</p> <p>SELECT student.*<br>
FROM student<br>
LEFT JOIN (SELECT s_id<br>
FROM score<br>
JOIN (SELECT c_id FROM course<br>
JOIN teacher ON course.t_id = teacher.t_id AND t_name = '张三')tmp2<br>
ON score.c_id = tmp2.c_id)tmp ON student.s_id = tmp.s_id<br>
WHERE tmp.s_id IS NULL;</p> <h2 id="查询两门及其以上不及格课程的同学的学号-姓名及其平均成绩"><a href="#查询两门及其以上不及格课程的同学的学号-姓名及其平均成绩" class="header-anchor">#</a> 查询两门及其以上不及格课程的同学的学号，姓名及其平均成绩</h2> <p>-- 关于sum里面可以使用计算条件的方式，很多人都不知道<br>
SELECT s.*,round(tmp.avg_score,1) as avg_score FROM student s INNER JOIN<br>
(SELECT s_id,avg(s_score) as avg_score FROM score GROUP BY s_id HAVING sum(s_score &lt; 60) &gt;=2) tmp<br>
ON s.s_id = tmp.s_id;</p> <p>SELECT student.s_id, student.s_name, tmp.avg_score<br>
FROM student<br>
LEFT JOIN (SELECT s_id, round(AVG(score.s_score)) avg_score FROM score GROUP BY s_id)tmp<br>
ON tmp.s_id = student.s_id<br>
WHERE student.s_id IN (SELECT s_id FROM score WHERE s_score &lt; 60 GROUP BY score.s_id HAVING count(s_id) &gt; 1);</p> <h2 id="检索-01-课程分数小于60-按分数降序排列的学生信息"><a href="#检索-01-课程分数小于60-按分数降序排列的学生信息" class="header-anchor">#</a> 检索&quot;01&quot;课程分数小于60，按分数降序排列的学生信息</h2> <p>SELECT student.*, s_score<br>
FROM student,<br>
score<br>
WHERE student.s_id = score.s_id<br>
AND s_score &lt; 60<br>
AND c_id = '01'<br>
ORDER BY s_score DESC;</p> <h2 id="按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩"><a href="#按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩" class="header-anchor">#</a> 按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩</h2> <p>-- 在查找的选项里还是可以有这种花式的写法的<br>
SELECT s_id,<br>
(SELECT s_score<br>
FROM score<br>
WHERE s_id = a.s_id<br>
AND c_id = '01')AS     语文,<br>
(SELECT s_score<br>
FROM score<br>
WHERE s_id = a.s_id<br>
AND c_id = '02')AS     数学,<br>
(SELECT s_score<br>
FROM score<br>
WHERE s_id = a.s_id<br>
AND c_id = '03')AS     英语,<br>
round(avg(s_score), 2) AS 平均分<br>
FROM score a<br>
GROUP BY s_id<br>
ORDER BY 平均分 DESC;</p> <p>–答案2<br>
-- 尝试使用group_concat 的方式处理,外连接的一点模糊领域，要知道一个都连不到的情况下才会出现null</p> <p>SELECT sc.s_id,avg(sc.s_score) as avg_score,group_concat(sc.s_score) FROM score sc<br>
RIGHT JOIN course c ON c.c_id = sc.c_id<br>
GROUP BY sc.s_id ORDER BY avg_score DESC ;</p> <p>-- 由于如果一旦使用了group by sid的方式，那么各科的成绩将无法获取，所以使用left join 多个表的形式处理<br>
SELECT a.s_id,<br>
tmp1.s_score             AS chinese,<br>
tmp2.s_score             AS math,<br>
tmp3.s_score             AS english,<br>
round(avg(a.s_score), 2) AS avgScore<br>
FROM score a<br>
LEFT JOIN (SELECT s_id, s_score FROM score s1 WHERE c_id = '01')tmp1 ON tmp1.s_id = a.s_id<br>
LEFT JOIN (SELECT s_id, s_score FROM score s2 WHERE c_id = '02')tmp2 ON tmp2.s_id = a.s_id<br>
LEFT JOIN (SELECT s_id, s_score FROM score s3 WHERE c_id = '03')tmp3 ON tmp3.s_id = a.s_id<br>
GROUP BY a.s_id, tmp1.s_score, tmp2.s_score, tmp3.s_score<br>
ORDER BY avgScore DESC;</p> <h2 id="查询各科成绩最高分、最低分和平均分-以如下形式显示-课程id-课程name-最高分-最低分-平均分-及格率-中等率-优良率-优秀率-及格为-60-中等为-70-80-优良为-80-90-优秀为-90"><a href="#查询各科成绩最高分、最低分和平均分-以如下形式显示-课程id-课程name-最高分-最低分-平均分-及格率-中等率-优良率-优秀率-及格为-60-中等为-70-80-优良为-80-90-优秀为-90" class="header-anchor">#</a> 查询各科成绩最高分、最低分和平均分：以如下形式显示：课程ID，课程name，最高分，最低分，平均分，及格率，中等率，优良率，优秀率 –及格为&gt;=60，中等为：70-80，优良为：80-90，优秀为：&gt;=90</h2> <p>-- 再次验证了sum里面的条件其实是可以直接等效为case when的，这样就非常方便了<br>
SELECT sc.c_id,c.c_name,avg(sc.s_score) avg_score,max(sc.s_score) max_score,<br>
min(sc.s_score) min_score,sum(s_score&gt;=60)/count(<em>) AS pass_rate,<br>
sum(s_score&gt;=80 AND s_score&lt;90)/count(</em>) AS good_rate<br>
FROM score sc INNER JOIN course c on sc.c_id =c.c_id GROUP BY sc.c_id;</p> <p>SELECT score.c_id    AS                                                                                     '课程ID',<br>
course.c_name AS                                                                                     '课程name',<br>
max(s_score)  AS                                                                                     '最高分',<br>
min(s_score)AS                                                                                       '最低分',<br>
round(avg(s_score), 2)                                                                               '平均分',<br>
round(sum(CASE WHEN s_score &gt;= 60 THEN 1 ELSE 0 END) / sum(CASE WHEN s_score THEN 1 ELSE 0 END), 2)'及格率',<br>
round(sum(CASE WHEN s_score &gt;= 70 AND s_score &lt; 80 THEN 1 ELSE 0 END) / sum(CASE WHEN s_score THEN 1 ELSE 0 END),<br>
2)'中等率',<br>
round(sum(CASE WHEN s_score &gt;= 80 AND s_score &lt; 90 THEN 1 ELSE 0 END) / sum(CASE WHEN s_score THEN 1 ELSE 0 END),<br>
2)'优良率',<br>
round(sum(CASE WHEN s_score &gt;= 90 THEN 1 ELSE 0 END) / (SUM(CASE WHEN s_score THEN 1 ELSE 0 END)), 2)'优秀率'<br>
FROM score<br>
LEFT JOIN course ON score.c_id = course.c_id<br>
GROUP BY score.c_id;</p> <p>–答案2</p> <p>SELECT course.c_id,<br>
course.c_name,<br>
tmp.maxScore,<br>
tmp.minScore,<br>
tmp.avgScore,<br>
tmp.passRate,<br>
tmp.moderate,<br>
tmp.goodRate,<br>
tmp.excellentRates<br>
FROM course<br>
JOIN (SELECT c_id,<br>
max(s_score) AS                                                                         maxScore,<br>
min(s_score)AS                                                                          minScore,<br>
round(avg(s_score), 2)                                                                  avgScore,<br>
round(sum(CASE WHEN s_score &gt;= 60 THEN 1 ELSE 0 END) / count(c_id), 2)passRate,<br>
round(sum(CASE WHEN s_score &gt;= 60 AND s_score &lt; 70 THEN 1 ELSE 0 END) / count(c_id), 2) moderate,<br>
round(sum(CASE WHEN s_score &gt;= 70 AND s_score &lt; 80 THEN 1 ELSE 0 END) / count(c_id), 2) goodRate,<br>
round(sum(CASE WHEN s_score &gt;= 80 AND s_score &lt; 90 THEN 1 ELSE 0 END) / count(c_id),<br>
2)                                                                                excellentRates<br>
FROM score<br>
GROUP BY c_id)tmp ON tmp.c_id = course.c_id;</p> <h2 id="按各科成绩进行排序-并显示排名-实现不完全"><a href="#按各科成绩进行排序-并显示排名-实现不完全" class="header-anchor">#</a> 按各科成绩进行排序，并显示排名(实现不完全)</h2> <p>– mysql没有rank函数<br>
–方法1<br>
-- 关于排名的sql，很蛋疼的是可能会涉及到不同的同分情况下，是否占用排名的形式<br>
-- 在select的项里面，可以使用查找语句，查找出的是一个值就是了</p> <p>(SELECT * FROM<br>
(SELECT s1.s_id, s1.c_id, s1.s_score,<br>
(SELECT COUNT(distinct sc.s_score) FROM score sc<br>
WHERE sc.s_score&gt;=s1.s_score AND sc.c_id = '01') as 'rank不保留排名'<br>
FROM score s1 WHERE s1.c_id = '01' ORDER BY s1.s_score DESC) t1)<br>
UNION (SELECT * FROM<br>
(SELECT s1.s_id, s1.c_id, s1.s_score,<br>
(SELECT COUNT(DISTINCT sc.s_score) FROM score sc<br>
WHERE sc.s_score&gt;=s1.s_score AND sc.c_id = '02') 'rank不保留排名'<br>
FROM score s1 WHERE s1.c_id = '02' ORDER BY s1.s_score DESC) t2)<br>
UNION (SELECT * FROM<br>
(SELECT s1.s_id, s1.c_id, s1.s_score,<br>
(SELECT COUNT(DISTINCT sc.s_score) FROM score sc<br>
WHERE sc.s_score&gt;=s1.s_score AND sc.c_id = '03') 'rank不保留排名'<br>
FROM score s1 WHERE s1.c_id = '03' ORDER BY s1.s_score DESC) t3)</p> <p>–方法2</p> <p>(SELECT a.s_id, a.c_id, @i:=@i+1 AS i保留排名,<br>
@k:=(CASE WHEN @score = a.s_score THEN @k ELSE @i END) AS rank不保留排名,<br>
@score:=a.s_score AS score<br>
FROM (SELECT * FROM score WHERE c_id = '01' GROUP BY s_id, c_id, s_score ORDER BY s_score DESC)a,<br>
(SELECT @i:=0, @k:=0, @score:=0)b)<br>
UNION<br>
(SELECT a.s_id, a.c_id, @m:=@m+1 AS i保留排名,<br>
@k:=(CASE WHEN @score = a.s_score THEN @k ELSE @m END) AS rank不保留排名,<br>
@score:=a.s_score AS score<br>
FROM (SELECT * FROM score WHERE c_id = '02' GROUP BY s_id, c_id, s_score ORDER BY s_score DESC)a,<br>
(SELECT @m:=0, @k:=0, @score:=0)b)<br>
UNION<br>
(SELECT a.s_id, a.c_id, @x:=@x+1 AS i保留排名,<br>
@k:=(CASE WHEN @score = a.s_score THEN @k ELSE @x END) AS rank不保留排名,<br>
@score:=a.s_score AS score<br>
FROM (SELECT * FROM score WHERE c_id = '03' GROUP BY s_id, c_id, s_score ORDER BY s_score DESC)a,<br>
(SELECT @x:=0, @k:=0, @score:=0)b);</p> <h2 id="查询学生的总成绩并进行排名"><a href="#查询学生的总成绩并进行排名" class="header-anchor">#</a> 查询学生的总成绩并进行排名</h2> <p>SELECT score.s_id, s_name, sum(s_score) sumscore<br>
FROM score,<br>
student<br>
WHERE score.s_id = student.s_id<br>
GROUP BY score.s_id<br>
ORDER BY sumscore DESC;</p> <h2 id="查询不同老师所教不同课程平均分从高到低显示"><a href="#查询不同老师所教不同课程平均分从高到低显示" class="header-anchor">#</a> 查询不同老师所教不同课程平均分从高到低显示</h2> <p>–方法1<br>
-- 自行写法,参考写法实在是多此一举啊<br>
SELECT t.t_id,sc.c_id,t.t_name,avg(sc.s_score) avgScore<br>
FROM teacher t INNER JOIN course c ON t.t_id = c.t_id<br>
INNER JOIN score sc ON sc.c_id = c.c_id<br>
GROUP BY t.t_id,sc.c_id ORDER BY avgScore DESC ;</p> <p>SELECT tmp.c_id, t_id, avgscore AS '平均分'<br>
FROM ((SELECT DISTINCT c_id, (round((SELECT avg(s_score) FROM score WHERE c_id = '01' GROUP BY c_id), 2))avgscore<br>
FROM score s1<br>
WHERE c_id = '01')<br>
UNION<br>
(SELECT DISTINCT c_id, (round((SELECT avg(s_score) FROM score WHERE c_id = '02' GROUP BY c_id), 2))avgscore<br>
FROM score s1<br>
WHERE c_id = '02')<br>
UNION<br>
(SELECT DISTINCT c_id, (round((SELECT avg(s_score) FROM score WHERE c_id = '03' GROUP BY c_id), 2))avgscore<br>
FROM score s1<br>
WHERE c_id = '03'))tmp,<br>
course<br>
WHERE tmp.c_id = course.c_id<br>
ORDER BY tmp.avgscore DESC;</p> <p>–方法2</p> <p>SELECT course.c_id, course.t_id, t_name, round(avg(s_score), 2)AS avgscore<br>
FROM course<br>
JOIN teacher ON teacher.t_id = course.t_id<br>
JOIN score ON course.c_id = score.c_id<br>
GROUP BY score.c_id<br>
ORDER BY avgscore DESC;</p> <p>–方法3<br>
-- 使用cross join 的方式反而是对查询效率的降级<br>
SELECT course.c_id, course.t_id, t_name, round(avg(s_score), 2)AS avgscore<br>
FROM course,<br>
teacher,<br>
score<br>
WHERE teacher.t_id = course.t_id<br>
AND course.c_id = score.c_id<br>
GROUP BY score.c_id<br>
ORDER BY avgscore DESC;</p> <h2 id="查询所有课程的成绩第2名到第3名的学生信息及该课程成绩"><a href="#查询所有课程的成绩第2名到第3名的学生信息及该课程成绩" class="header-anchor">#</a> 查询所有课程的成绩第2名到第3名的学生信息及该课程成绩</h2> <p>–方法1<br>
-- 由于这种情况下，group by 之后没有办法使用limit，而这种特定的名词就是使用Limit的处理合适，所以就使用union进行连接</p> <p>(SELECT student.<em>, tmp1.c_id, tmp1.s_score FROM student,<br>
(SELECT s_id, c_id, s_score FROM score WHERE c_id = '01' ORDER BY s_score DESC LIMIT 1, 2)tmp1<br>
WHERE student.s_id = tmp1.s_id)<br>
UNION (SELECT student.</em>, tmp2.c_id, tmp2.s_score FROM student,<br>
(SELECT s_id, c_id, s_score FROM score WHERE c_id = '02' ORDER BY s_score DESC LIMIT 1, 2)tmp2<br>
WHERE student.s_id = tmp2.s_id)<br>
UNION (SELECT student.*, tmp3.c_id, tmp3.s_score FROM student,<br>
(SELECT s_id, c_id, s_score FROM score WHERE c_id = '03' ORDER BY s_score DESC LIMIT 1, 2)tmp3<br>
WHERE student.s_id = tmp3.s_id);</p> <p>–方法2<br>
-- 直接找出排名，然后对排名进行筛选，当然是一种方法，但是并不推荐<br>
(SELECT student.<em>, tmp.c_id, tmp.s_score, tmp.排名 FROM (<br>
SELECT a.s_id, a.c_id, a.s_score, @i:=@i+1 AS 排名 FROM score a, (SELECT @i:=0)b<br>
WHERE a.c_id = '01' ORDER BY a.s_score DESC<br>
)tmp JOIN student ON tmp.s_id = student.s_id WHERE 排名 BETWEEN 2 AND 3)<br>
UNION (<br>
SELECT student.</em>, tmp.c_id, tmp.s_score, tmp.排名 FROM (<br>
SELECT a.s_id, a.c_id, a.s_score, @j:=@j+1 AS 排名 FROM score a, (SELECT @j:=0)b<br>
WHERE a.c_id = '02' ORDER BY a.s_score DESC<br>
)tmp JOIN student ON tmp.s_id = student.s_id WHERE 排名 BETWEEN 2 AND 3<br>
) UNION (<br>
SELECT student.*, tmp.c_id, tmp.s_score, tmp.排名 FROM (<br>
SELECT a.s_id, a.c_id, a.s_score, @k:=@k+1 AS 排名 FROM score a, (SELECT @k:=0)b<br>
WHERE a.c_id = '03' ORDER BY a.s_score DESC<br>
)tmp JOIN student ON tmp.s_id = student.s_id WHERE 排名 BETWEEN 2 AND 3);</p> <h2 id="统计各科成绩各分数段人数-课程编号-课程名称-100-85-85-70-70-60-0-60及所占百分比"><a href="#统计各科成绩各分数段人数-课程编号-课程名称-100-85-85-70-70-60-0-60及所占百分比" class="header-anchor">#</a> 统计各科成绩各分数段人数：课程编号,课程名称,100-85,85-70,70-60,0-60及所占百分比</h2> <p>-- 很简单可以搞定的东西，为何需要那么复杂啊。。<br>
select c.c_id,c.c_name,<br>
sum(sc.s_score&lt;=100 AND sc.s_score&gt;=85) AS a,<br>
sum(sc.s_score&lt;85 AND sc.s_score&gt;=70) AS b,<br>
sum(sc.s_score&lt;70 AND sc.s_score&gt;=60) AS c<br>
FROM course c INNER JOIN score sc ON c.c_id = sc.c_id<br>
GROUP BY c.c_id ;</p> <h2 id="查询学生平均成绩及其名次"><a href="#查询学生平均成绩及其名次" class="header-anchor">#</a> 查询学生平均成绩及其名次</h2> <ul><li>因为MySQL没有rowcount的函数，所以需要使用此种形式</li></ul> <p>SELECT a.s_id, a.s_name, a.平均分, @i := @i + 1 AS 排名<br>
FROM (SELECT student.s_id, student.s_name, avg(score.s_score) AS &quot;平均分&quot;<br>
FROM student,<br>
score<br>
WHERE student.s_id = score.s_id<br>
GROUP BY score.s_id<br>
ORDER BY <code>平均分</code> DESC)a,<br>
(SELECT @i := 0)b;</p> <h2 id="查询各科成绩前三名的记录"><a href="#查询各科成绩前三名的记录" class="header-anchor">#</a> 查询各科成绩前三名的记录</h2> <p>– 1.选出b表比a表成绩大的所有组<br>
– 2.选出比当前id成绩大的 小于三个的<br>
–没有查学生姓名</p> <ul><li>查找前几名的方法，使用find_in_set真的是可以事半功倍啊！！<br>
SELECT s1.*,s2.c_name  FROM score s1 INNER JOIN<br>
(SELECT sc.c_id,c.c_name,group_concat(sc.s_id ORDER BY sc.s_score DESC) as sids<br>
FROM score sc INNER JOIN course c on c.c_id = sc.c_id GROUP BY sc.c_id) s2 ON s1.c_id = s2.c_id WHERE<br>
find_in_set(s1.s_id,s2.sids) BETWEEN 1 AND 3 ORDER BY s1.c_id,s1.s_score DESC ;</li></ul> <p>(SELECT score.c_id, course.c_name, s_score FROM score, course<br>
WHERE score.c_id = '01' AND course.c_id = score.c_id ORDER BY s_score DESC LIMIT 3)<br>
UNION<br>
(SELECT score.c_id, course.c_name, s_score FROM score, course<br>
WHERE score.c_id = '02' AND course.c_id = score.c_id ORDER BY s_score DESC LIMIT 3)<br>
UNION<br>
(SELECT score.c_id, course.c_name, s_score FROM score, course<br>
WHERE score.c_id = '03' AND course.c_id = score.c_id ORDER BY s_score DESC LIMIT 3);</p> <p>–查了学生姓名</p> <p>(SELECT score.c_id, course.c_name, student.s_name, s_score FROM score<br>
JOIN student ON student.s_id = score.s_id<br>
JOIN course ON score.c_id = '01' AND course.c_id = score.c_id ORDER BY s_score DESC LIMIT 3)<br>
UNION (<br>
SELECT score.c_id, course.c_name, student.s_name, s_score FROM score<br>
JOIN student ON student.s_id = score.s_id<br>
JOIN course ON score.c_id = '02' AND course.c_id = score.c_id ORDER BY s_score DESC LIMIT 3</p> <p>) UNION (<br>
SELECT score.c_id, course.c_name, student.s_name, s_score FROM score<br>
JOIN student ON student.s_id = score.s_id<br>
JOIN course ON score.c_id = '03' AND course.c_id = score.c_id ORDER BY s_score DESC LIMIT 3);</p> <h2 id="查询每门课程被重修的学生数"><a href="#查询每门课程被重修的学生数" class="header-anchor">#</a> 查询每门课程被重修的学生数</h2> <ul><li>能直接连接就不要使用子查询，使用count(1)的形式其实是不严谨的<br>
SELECT  c.c_id,c.c_name,count(DISTINCT sc.s_id) AS cnt FROM course c LEFT JOIN score sc ON c.c_id = sc.c_id<br>
WHERE sc.s_score &lt; 60<br>
GROUP BY c.c_id;</li></ul> <p>SELECT c.c_id, c.c_name, a.<code>被选修人数</code><br>
FROM course c<br>
JOIN (SELECT c_id, count(1) AS <code>被选修人数</code> FROM score WHERE score.s_score &lt; 60 GROUP BY score.c_id)a<br>
ON a.c_id = c.c_id;</p> <h2 id="查询出只有两门课程的全部学生的学号和姓名"><a href="#查询出只有两门课程的全部学生的学号和姓名" class="header-anchor">#</a> 查询出只有两门课程的全部学生的学号和姓名</h2> <ul><li>还是那句话，如果已经group by了完全的s_id了，那么其他的项都是可以获取到的<br>
SELECT s.s_id,s.s_name<br>
FROM student s INNER JOIN score sc ON s.s_id = sc.s_id GROUP BY s.s_id HAVING count(DISTINCT c_id) = 2;</li></ul> <p>SELECT st.s_id, st.s_name<br>
FROM student st<br>
JOIN (SELECT s_id FROM score GROUP BY s_id HAVING count(c_id) = 2)a ON st.s_id = a.s_id;</p> <h2 id="查询男生、女生人数"><a href="#查询男生、女生人数" class="header-anchor">#</a> 查询男生、女生人数</h2> <p>SELECT<br>
sum(s_sex = '男') as male,<br>
sum(s_sex = '女') as female<br>
FROM student;</p> <p>SELECT a.男生人数, b.女生人数<br>
FROM (SELECT count(1) AS 男生人数 FROM student WHERE s_sex = '男')a,<br>
(SELECT count(1) AS 女生人数 FROM student WHERE s_sex = '女')b;</p> <h2 id="查询名字中含有-风-字的学生信息"><a href="#查询名字中含有-风-字的学生信息" class="header-anchor">#</a> 查询名字中含有&quot;风&quot;字的学生信息</h2> <p>SELECT *<br>
FROM student<br>
WHERE s_name LIKE '%风%';</p> <h2 id="查询同名同性学生名单-并统计同名人数"><a href="#查询同名同性学生名单-并统计同名人数" class="header-anchor">#</a> 查询同名同性学生名单，并统计同名人数</h2> <ul><li><p>统计个数就是聚合的方式，很简单，直接group by就是了，大不了再用find_in_set就是了<br>
SELECT s_name,s_sex,GROUP_CONCAT(s_id) sids,count(s_id) cnt<br>
FROM student GROUP BY s_name,s_sex HAVING count(s_id) &gt;=2;</p></li> <li><p>这是错误的写法，老哥啊<br>
SELECT s1.s_name, s1.s_sex, count(*) AS 同名人数<br>
FROM student s1,<br>
student s2<br>
WHERE s1.s_name = s2.s_name<br>
AND s1.s_id &lt;&gt; s2.s_id<br>
AND s1.s_sex = s2.s_sex<br>
GROUP BY s1.s_name, s1.s_sex;</p></li></ul> <h2 id="查询1990年出生的学生名单"><a href="#查询1990年出生的学生名单" class="header-anchor">#</a> 查询1990年出生的学生名单</h2> <p>SELECT *<br>
FROM student<br>
WHERE s_birth LIKE '1990%';</p> <h2 id="查询每门课程的平均成绩-结果按平均成绩降序排列-平均成绩相同时-按课程编号升序排列"><a href="#查询每门课程的平均成绩-结果按平均成绩降序排列-平均成绩相同时-按课程编号升序排列" class="header-anchor">#</a> 查询每门课程的平均成绩，结果按平均成绩降序排列，平均成绩相同时，按课程编号升序排列</h2> <p>SELECT score.c_id, c_name, round(avg(s_score), 2) AS 平均成绩<br>
FROM score<br>
JOIN course ON score.c_id = course.c_id<br>
GROUP BY c_id<br>
ORDER BY <code>平均成绩</code> DESC, score.c_id ASC;</p> <h2 id="查询平均成绩大于等于85的所有学生的学号、姓名和平均成绩"><a href="#查询平均成绩大于等于85的所有学生的学号、姓名和平均成绩" class="header-anchor">#</a> 查询平均成绩大于等于85的所有学生的学号、姓名和平均成绩</h2> <p>SELECT s.s_id,s.s_name,round(avg(sc.s_score),2) AS avgScore<br>
FROM student s INNER JOIN score sc ON s.s_id = sc.s_id<br>
GROUP BY s.s_id HAVING avgScore &gt;= 85;</p> <p>SELECT score.s_id, s_name, round(avg(s_score), 2)AS 平均成绩<br>
FROM score<br>
JOIN student ON student.s_id = score.s_id<br>
GROUP BY score.s_id<br>
HAVING <code>平均成绩</code> &gt;= 85;</p> <h2 id="查询课程名称为-数学-且分数低于60的学生姓名和分数"><a href="#查询课程名称为-数学-且分数低于60的学生姓名和分数" class="header-anchor">#</a> 查询课程名称为&quot;数学&quot;，且分数低于60的学生姓名和分数</h2> <p>SELECT s_name, s_score AS 数学成绩<br>
FROM student<br>
JOIN (SELECT s_id, s_score<br>
FROM score,<br>
course<br>
WHERE score.c_id = course.c_id<br>
AND c_name = '数学')a ON a.s_score &lt; 60 AND student.s_id = a.s_id;</p> <h2 id="查询所有学生的课程及分数情况"><a href="#查询所有学生的课程及分数情况" class="header-anchor">#</a> 查询所有学生的课程及分数情况</h2> <ul><li>相当于行列转换的用法了，由于需要就算总分，必须要要使用聚合<br>
SELECT a.s_name,<br>
SUM(CASE c.c_name WHEN '语文' THEN b.s_score ELSE 0 END) AS 语文,<br>
SUM(CASE c.c_name WHEN '数学' THEN b.s_score ELSE 0 END) AS 数学,<br>
SUM(CASE c.c_name WHEN '英语' THEN b.s_score ELSE 0 END) AS 英语,<br>
SUM(b.s_score)                                         AS 总分<br>
FROM student a<br>
JOIN score b ON a.s_id = b.s_id<br>
JOIN course c ON b.c_id = c.c_id<br>
GROUP BY s_name, a.s_id;</li></ul> <h2 id="查询任何一门课程成绩在70分以上的学生姓名、课程名称和分数"><a href="#查询任何一门课程成绩在70分以上的学生姓名、课程名称和分数" class="header-anchor">#</a> 查询任何一门课程成绩在70分以上的学生姓名、课程名称和分数</h2> <p>SELECT s.s_id,s.s_name,sc.s_score FROM student s INNER JOIN score sc ON s.s_id = sc.s_id<br>
WHERE sc.s_id not IN<br>
(SELECT s_id FROM score WHERE s_score &lt; 70 GROUP BY s_id);</p> <ul><li>又是一个错误的写法<br>
SELECT s_name, c_name, s_score<br>
FROM score<br>
JOIN student ON student.s_id = score.s_id<br>
JOIN course ON score.c_id = course.c_id<br>
WHERE s_score &lt; 70;</li></ul> <h2 id="查询不及格的课程"><a href="#查询不及格的课程" class="header-anchor">#</a> 查询不及格的课程</h2> <p>SELECT s_name, c_name AS 不及格课程, tmp.s_score<br>
FROM student<br>
JOIN (SELECT s_id, s_score, c_name<br>
FROM score,<br>
course<br>
WHERE score.c_id = course.c_id<br>
AND s_score &lt; 60)tmp ON student.s_id = tmp.s_id;</p> <h2 id="查询课程编号为01且课程成绩在80分以上的学生的学号和姓名"><a href="#查询课程编号为01且课程成绩在80分以上的学生的学号和姓名" class="header-anchor">#</a> 查询课程编号为01且课程成绩在80分以上的学生的学号和姓名</h2> <p>SELECT student.s_id, s_name, s_score AS score_01<br>
FROM student<br>
JOIN score ON student.s_id = score.s_id<br>
WHERE c_id = '01'<br>
AND s_score &gt;= 80;</p> <h2 id="求每门课程的学生人数"><a href="#求每门课程的学生人数" class="header-anchor">#</a> 求每门课程的学生人数</h2> <p>SELECT course.c_id, course.c_name, count(1)AS 选课人数<br>
FROM course<br>
JOIN score ON course.c_id = score.c_id<br>
GROUP BY score.c_id;</p> <h2 id="查询选修-张三-老师所授课程的学生中-成绩最高的学生信息及其成绩"><a href="#查询选修-张三-老师所授课程的学生中-成绩最高的学生信息及其成绩" class="header-anchor">#</a> 查询选修&quot;张三&quot;老师所授课程的学生中，成绩最高的学生信息及其成绩</h2> <p>– 查询老师id</p> <ul><li>此种查法会丢失调同样都是最高分的学生<br>
SELECT s.*,c.c_name,sc.s_score<br>
FROM student s INNER JOIN score sc ON s.s_id = sc.s_id<br>
INNER join course c  ON sc.c_id = c.c_id<br>
INNER JOIN teacher t ON c.t_id = t.t_id<br>
WHERE t.t_name= '张三' ORDER BY sc.s_score DESC LIMIT 1;</li></ul> <p>select s.*,sc.s_score FROM student s inner join score sc ON s.s_id = sc.s_id<br>
where sc.s_score = (<br>
SELECT max(sc.s_score)<br>
FROM  score sc INNER join course c  ON sc.c_id = c.c_id<br>
INNER JOIN teacher t ON c.t_id = t.t_id<br>
WHERE t.t_name= '张三'<br>
);</p> <p>– 查询最高分（可能有相同分数）</p> <p>SELECT  max(s_score)<br>
FROM score<br>
JOIN (SELECT course.c_id, c_name<br>
FROM course,<br>
(SELECT t_id, t_name FROM teacher WHERE t_name = '张三')tmp<br>
WHERE course.t_id = tmp.t_id)tmp2 ON score.c_id = tmp2.c_id;</p> <h2 id="查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩"><a href="#查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩" class="header-anchor">#</a> 查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩</h2> <p>SELECT DISTINCT a.s_id, a.c_id, a.s_score<br>
FROM score a,<br>
score b<br>
WHERE a.c_id &lt;&gt; b.c_id<br>
AND a.s_score = b.s_score;</p> <h2 id="查询每门课程成绩最好的前两名"><a href="#查询每门课程成绩最好的前两名" class="header-anchor">#</a> 查询每门课程成绩最好的前两名</h2> <p>–方法1(该方法有bug, 不能查出临界的重复值, 例如查各科的第一名或前三名)</p> <ul><li>这里如果第一名的话，显然就有问题了<br>
SELECT a.s_id, a.c_id, a.s_score<br>
FROM score a<br>
WHERE (SELECT count(1)<br>
FROM score b<br>
WHERE a.c_id = b.c_id<br>
AND b.s_score &gt;= a.s_score) &lt;= 2<br>
ORDER BY a.c_id ASC, a.s_score DESC;</li></ul> <p>–方法2(查前三名)</p> <ul><li>达成这种效果的话，其实find_in_set的方式更加合理和擅长<br>
(SELECT * FROM score WHERE c_id = '01' ORDER BY s_score DESC LIMIT 3)<br>
UNION (<br>
SELECT * FROM score WHERE c_id = '02' ORDER BY s_score DESC LIMIT 3)<br>
UNION (<br>
SELECT * FROM score WHERE c_id = '03' ORDER BY s_score DESC LIMIT 3);</li></ul> <p>-方法三</p> <ul><li>仍然是使用find_in_set的方式，比起其他的真是好用很多了<br>
SELECT sc.* FROM score sc INNER JOIN<br>
(SELECT c_id,group_concat(s_id ORDER by s_score DESC) sids<br>
FROM score GROUP BY c_id) tmp ON sc.c_id = tmp.c_id WHERE<br>
find_in_set(sc.s_id,tmp.sids) BETWEEN 1 AND 2 ORDER BY sc.c_id,s_score DESC ;</li></ul> <h2 id="统计每门课程的学生选修人数-超过5人的课程才统计-。要求输出课程号和选修人数-查询结果按人数降序排列-若人数相同-按课程号升序排列"><a href="#统计每门课程的学生选修人数-超过5人的课程才统计-。要求输出课程号和选修人数-查询结果按人数降序排列-若人数相同-按课程号升序排列" class="header-anchor">#</a> 统计每门课程的学生选修人数（超过5人的课程才统计）。要求输出课程号和选修人数，查询结果按人数降序排列，若人数相同，按课程号升序排列</h2> <p>SELECT DISTINCT course.c_id, tmp.选修人数<br>
FROM course<br>
JOIN (SELECT c_id, count(1) AS 选修人数 FROM score GROUP BY c_id)tmp<br>
WHERE tmp.选修人数 &gt;= 5<br>
ORDER BY tmp.选修人数 DESC, course.c_id ASC;</p> <h2 id="检索至少选修两门课程的学生学号"><a href="#检索至少选修两门课程的学生学号" class="header-anchor">#</a> 检索至少选修两门课程的学生学号</h2> <p>SELECT s_id, count(c_id) AS totalCourse<br>
FROM score<br>
GROUP BY s_id<br>
HAVING count(c_id) &gt;= 2;</p> <h2 id="查询选修了全部课程的学生信息"><a href="#查询选修了全部课程的学生信息" class="header-anchor">#</a> 查询选修了全部课程的学生信息</h2> <p>SELECT student.*<br>
FROM student,<br>
(SELECT s_id, count(c_id) AS totalCourse FROM score GROUP BY s_id)tmp<br>
WHERE student.s_id = tmp.s_id<br>
AND totalCourse = 3;</p> <h2 id="查询各学生的年龄"><a href="#查询各学生的年龄" class="header-anchor">#</a> 查询各学生的年龄</h2> <p>– 按照出生日期来算，当前月日 &lt; 出生年月的月日则，年龄减一</p> <ul><li>date_format之后的可以直接进行加减运算，这个就算是记下了<br>
SELECT s_name, s_birth, (DATE_FORMAT(NOW(), '%Y') - DATE_FORMAT(s_birth, '%Y') -<br>
CASE<br>
WHEN (DATE_FORMAT(NOW(), '%m%d') &gt; DATE_FORMAT(s_birth, '%m%d')) THEN 1<br>
ELSE 0 END) AS age<br>
FROM student;</li></ul> <h2 id="查询本周过生日的学生"><a href="#查询本周过生日的学生" class="header-anchor">#</a> 查询本周过生日的学生</h2> <p>–方法1<br>
SELECT *,week(s_birth) FROM student<br>
WHERE week(now()) = week(concat(date_format(now(),'%Y'),date_format(s_birth,'%m%d')));</p> <ul><li>以下全错啊！！<br>
SELECT *<br>
FROM student<br>
WHERE WEEK(DATE_FORMAT(NOW(), '%Y%m%d')) = WEEK(s_birth);</li></ul> <h2 id="查询本月过生日的学生"><a href="#查询本月过生日的学生" class="header-anchor">#</a> 查询本月过生日的学生</h2> <p>–方法1</p> <p>SELECT *,month(s_birth)<br>
FROM student<br>
WHERE MONTH(DATE_FORMAT(NOW(), '%Y%m%d')) = MONTH(s_birth);<br>
–方法2</p> <ul><li>这种方法很不正规<br>
SELECT s_name, s_sex, s_birth<br>
FROM student<br>
WHERE substring(s_birth, 6, 2) = '03';</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后编辑时间:</span> <span class="time">12/24/2020, 3:33:40 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/experience/tomcat假死.html" class="prev">
        tomcat假死
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.27b2d4ce.js" defer></script><script src="/assets/js/4.9a9f6078.js" defer></script><script src="/assets/js/69.23fa6377.js" defer></script>
  </body>
</html>
