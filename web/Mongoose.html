<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>kikfan</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css">
    <meta name="description" content="kikfan">
    
    <link rel="preload" href="/assets/css/2.styles.051e8285.css" as="style"><link rel="preload" href="/assets/js/app.27b2d4ce.js" as="script"><link rel="preload" href="/assets/js/4.9a9f6078.js" as="script"><link rel="preload" href="/assets/js/35.62b9a752.js" as="script"><link rel="prefetch" href="/assets/js/0.e4e7bdd7.js"><link rel="prefetch" href="/assets/js/1.fa961c29.js"><link rel="prefetch" href="/assets/js/10.731ee775.js"><link rel="prefetch" href="/assets/js/100.8f4b7cc5.js"><link rel="prefetch" href="/assets/js/101.a083f158.js"><link rel="prefetch" href="/assets/js/102.2c3648c3.js"><link rel="prefetch" href="/assets/js/103.f00d7dd8.js"><link rel="prefetch" href="/assets/js/104.0c414ab7.js"><link rel="prefetch" href="/assets/js/105.683675df.js"><link rel="prefetch" href="/assets/js/106.733b71a1.js"><link rel="prefetch" href="/assets/js/107.16837d98.js"><link rel="prefetch" href="/assets/js/108.28ae623b.js"><link rel="prefetch" href="/assets/js/109.a702f251.js"><link rel="prefetch" href="/assets/js/11.d7b558c8.js"><link rel="prefetch" href="/assets/js/110.74980c24.js"><link rel="prefetch" href="/assets/js/111.bf05772f.js"><link rel="prefetch" href="/assets/js/112.7f823ce5.js"><link rel="prefetch" href="/assets/js/113.4145bf66.js"><link rel="prefetch" href="/assets/js/114.4466ba9a.js"><link rel="prefetch" href="/assets/js/115.7066e3ba.js"><link rel="prefetch" href="/assets/js/116.dc1f78b7.js"><link rel="prefetch" href="/assets/js/117.88fe74db.js"><link rel="prefetch" href="/assets/js/118.e37e03b4.js"><link rel="prefetch" href="/assets/js/119.d7e4f790.js"><link rel="prefetch" href="/assets/js/12.42f2fa87.js"><link rel="prefetch" href="/assets/js/13.41e1d4b5.js"><link rel="prefetch" href="/assets/js/14.5b7e8e37.js"><link rel="prefetch" href="/assets/js/15.d9e0fc06.js"><link rel="prefetch" href="/assets/js/16.87dd9a3b.js"><link rel="prefetch" href="/assets/js/17.d120ed17.js"><link rel="prefetch" href="/assets/js/18.59184376.js"><link rel="prefetch" href="/assets/js/19.39139a03.js"><link rel="prefetch" href="/assets/js/20.2d9ec408.js"><link rel="prefetch" href="/assets/js/21.6e654bc3.js"><link rel="prefetch" href="/assets/js/22.1a060135.js"><link rel="prefetch" href="/assets/js/23.dcf0bfcc.js"><link rel="prefetch" href="/assets/js/24.9b4a4b3e.js"><link rel="prefetch" href="/assets/js/25.f57f3c65.js"><link rel="prefetch" href="/assets/js/26.fc43a3ae.js"><link rel="prefetch" href="/assets/js/27.e9aaf732.js"><link rel="prefetch" href="/assets/js/28.6e1886c7.js"><link rel="prefetch" href="/assets/js/29.ff720b7d.js"><link rel="prefetch" href="/assets/js/30.297554f4.js"><link rel="prefetch" href="/assets/js/31.fc02f056.js"><link rel="prefetch" href="/assets/js/32.978c9766.js"><link rel="prefetch" href="/assets/js/33.faa483ef.js"><link rel="prefetch" href="/assets/js/34.7f3cc871.js"><link rel="prefetch" href="/assets/js/36.c08848fc.js"><link rel="prefetch" href="/assets/js/37.59f685b7.js"><link rel="prefetch" href="/assets/js/38.c1588f41.js"><link rel="prefetch" href="/assets/js/39.fdb35fe6.js"><link rel="prefetch" href="/assets/js/40.65505803.js"><link rel="prefetch" href="/assets/js/41.54da323c.js"><link rel="prefetch" href="/assets/js/42.45bbba91.js"><link rel="prefetch" href="/assets/js/43.1f36637d.js"><link rel="prefetch" href="/assets/js/44.d7d8a539.js"><link rel="prefetch" href="/assets/js/45.7d764f0b.js"><link rel="prefetch" href="/assets/js/46.3bad6567.js"><link rel="prefetch" href="/assets/js/47.2946a535.js"><link rel="prefetch" href="/assets/js/48.85cbb854.js"><link rel="prefetch" href="/assets/js/49.315a2781.js"><link rel="prefetch" href="/assets/js/5.60a71eda.js"><link rel="prefetch" href="/assets/js/50.58a11a9c.js"><link rel="prefetch" href="/assets/js/51.ea33dd6c.js"><link rel="prefetch" href="/assets/js/52.c9f47820.js"><link rel="prefetch" href="/assets/js/53.012a446d.js"><link rel="prefetch" href="/assets/js/54.2c4f1849.js"><link rel="prefetch" href="/assets/js/55.2a967be9.js"><link rel="prefetch" href="/assets/js/56.2d46c0a0.js"><link rel="prefetch" href="/assets/js/57.c8880e0a.js"><link rel="prefetch" href="/assets/js/58.a6b007f9.js"><link rel="prefetch" href="/assets/js/59.97b9b7e5.js"><link rel="prefetch" href="/assets/js/6.afcd84ec.js"><link rel="prefetch" href="/assets/js/60.f4a784fc.js"><link rel="prefetch" href="/assets/js/61.05eed8fc.js"><link rel="prefetch" href="/assets/js/62.d95be5f8.js"><link rel="prefetch" href="/assets/js/63.c0d0a152.js"><link rel="prefetch" href="/assets/js/64.f74c6626.js"><link rel="prefetch" href="/assets/js/65.4872ba36.js"><link rel="prefetch" href="/assets/js/66.3846d75c.js"><link rel="prefetch" href="/assets/js/67.5d3c513c.js"><link rel="prefetch" href="/assets/js/68.4c28dad7.js"><link rel="prefetch" href="/assets/js/69.23fa6377.js"><link rel="prefetch" href="/assets/js/7.69deb300.js"><link rel="prefetch" href="/assets/js/70.a1673575.js"><link rel="prefetch" href="/assets/js/71.53175f3c.js"><link rel="prefetch" href="/assets/js/72.699361e6.js"><link rel="prefetch" href="/assets/js/73.683bacf8.js"><link rel="prefetch" href="/assets/js/74.d27b950a.js"><link rel="prefetch" href="/assets/js/75.30cfcf8c.js"><link rel="prefetch" href="/assets/js/76.7115ba1f.js"><link rel="prefetch" href="/assets/js/77.61f7aec4.js"><link rel="prefetch" href="/assets/js/78.d9b71b38.js"><link rel="prefetch" href="/assets/js/79.8df96305.js"><link rel="prefetch" href="/assets/js/8.b5d41094.js"><link rel="prefetch" href="/assets/js/80.caefa481.js"><link rel="prefetch" href="/assets/js/81.fbe7f1af.js"><link rel="prefetch" href="/assets/js/82.8a0c0e86.js"><link rel="prefetch" href="/assets/js/83.77f553eb.js"><link rel="prefetch" href="/assets/js/84.9d3058ad.js"><link rel="prefetch" href="/assets/js/85.d66493d7.js"><link rel="prefetch" href="/assets/js/86.d82b3465.js"><link rel="prefetch" href="/assets/js/87.ff69dfdc.js"><link rel="prefetch" href="/assets/js/88.db8a809d.js"><link rel="prefetch" href="/assets/js/89.dbae01c0.js"><link rel="prefetch" href="/assets/js/9.42dfa068.js"><link rel="prefetch" href="/assets/js/90.ac501b95.js"><link rel="prefetch" href="/assets/js/91.de4c7a0e.js"><link rel="prefetch" href="/assets/js/92.689f4272.js"><link rel="prefetch" href="/assets/js/93.17e1c4ae.js"><link rel="prefetch" href="/assets/js/94.1978b8c9.js"><link rel="prefetch" href="/assets/js/95.fb0afeb1.js"><link rel="prefetch" href="/assets/js/96.8b6541d8.js"><link rel="prefetch" href="/assets/js/97.793aa5c6.js"><link rel="prefetch" href="/assets/js/98.62b7c58e.js"><link rel="prefetch" href="/assets/js/99.54020815.js">
    <link rel="stylesheet" href="/assets/css/2.styles.051e8285.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">kikfan</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/idea/" class="nav-link">
  IDEA
</a></div><div class="nav-item"><a href="/devops/" class="nav-link">
  DevOps
</a></div><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  Web
</a></div><div class="nav-item"><a href="/curiousness/" class="nav-link">
  好奇尚异
</a></div><div class="nav-item"><a href="/long-road/" class="nav-link">
  道阻且长
</a></div><div class="nav-item"><a href="/step-back/" class="nav-link">
  海阔天空
</a></div><div class="nav-item"><a href="/experience/" class="nav-link">
  吃堑长智
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  Tools
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/idea/" class="nav-link">
  IDEA
</a></div><div class="nav-item"><a href="/devops/" class="nav-link">
  DevOps
</a></div><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  Web
</a></div><div class="nav-item"><a href="/curiousness/" class="nav-link">
  好奇尚异
</a></div><div class="nav-item"><a href="/long-road/" class="nav-link">
  道阻且长
</a></div><div class="nav-item"><a href="/step-back/" class="nav-link">
  海阔天空
</a></div><div class="nav-item"><a href="/experience/" class="nav-link">
  吃堑长智
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  Tools
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Web</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/web/CryptoJs 加解密.html" class="sidebar-link">CryptoJs 加解密</a></li><li><a href="/web/ECMAscript.html" class="sidebar-link">ECMAscript</a></li><li><a href="/web/Egg 更加优雅的 Controller 数据返回.html" class="sidebar-link">Egg 更加优雅的 Controller 数据返回</a></li><li><a href="/web/Egg 集成 Apollo.html" class="sidebar-link">Egg 集成 Apollo</a></li><li><a href="/web/Google V8.html" class="sidebar-link">Google V8</a></li><li><a href="/web/JS 数组整理.html" class="sidebar-link">JS 数组整理</a></li><li><a href="/web/Js 事件机制.html" class="sidebar-link">Js 事件机制</a></li><li><a href="/web/Js 作用域.html" class="sidebar-link">Js 作用域</a></li><li><a href="/web/Js 闭包 .html" class="sidebar-link">Js 闭包 </a></li><li><a href="/web/Lodash.html" class="sidebar-link">Lodash</a></li><li><a href="/web/MongoDB.html" class="sidebar-link">MongoDB</a></li><li><a href="/web/Mongoose.html" aria-current="page" class="active sidebar-link">Mongoose</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/web/Node 转发文件上传.html" class="sidebar-link">Node 转发文件上传</a></li><li><a href="/web/Node.html" class="sidebar-link">Node</a></li><li><a href="/web/Node.js 知识点整理.html" class="sidebar-link">Node.js 知识点整理</a></li><li><a href="/web/TypeScript.html" class="sidebar-link">TypeScript</a></li><li><a href="/web/d8.html" class="sidebar-link">d8</a></li><li><a href="/web/egg.html" class="sidebar-link">egg</a></li><li><a href="/web/vue 整理.html" class="sidebar-link">vue 整理</a></li><li><a href="/web/代码风格.html" class="sidebar-link">代码风格</a></li><li><a href="/web/前后端 接口验签.html" class="sidebar-link">前后端 接口验签</a></li><li><a href="/web/简易的敏感词处理.html" class="sidebar-link">简易的敏感词处理</a></li><li><a href="/web/自动导出 JS 模块.html" class="sidebar-link">自动导出 JS 模块</a></li><li><a href="/web/项目文件清理.html" class="sidebar-link">项目文件清理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#id-不能直接和-string-进行比较">_Id 不能直接和 String  进行比较</a></li><li><a href="#toobject-tojson">toObject toJson</a></li><li><a href="#lean">lean</a></li><li><a href="#字段递增、递减">字段递增、递减</a></li><li><a href="#常用查询">常用查询</a></li><li><a href="#修改">修改</a></li><li><a href="#删除">删除</a></li><li><a href="#aggregate">aggregate</a></li><li><a href="#mongodb-导入导出">MongoDB 导入导出</a></li><li><a href="#model-virtual">Model Virtual</a></li><li><a href="#固定集合-capped">固定集合 capped</a></li></ul></div><p></p> <h3 id="id-不能直接和-string-进行比较"><a href="#id-不能直接和-string-进行比较" class="header-anchor">#</a> _Id 不能直接和 String  进行比较</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>user<span class="token punctuation">.</span>_id <span class="token operator">===</span> article<span class="token punctuation">.</span>userId
</code></pre></div><p>在 mongoose 中不能使用上面的比较，因为 monoose 中的 _id 是ObjectID 类型，是 BSON 中的一种类型，所以不能直接比较，如果需要比较，则可以用 ObjectId 中的 equals 方法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>user<span class="token punctuation">.</span>_id<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>userId<span class="token punctuation">)</span>
</code></pre></div><h3 id="toobject-tojson"><a href="#toobject-tojson" class="header-anchor">#</a> toObject toJson</h3> <p>在mongoose 中查询出来的对象默认是不可更改的，如果需要更改，则需要在对象后添加 toObject 才能更改</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
model<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;model name&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// null</span>

model <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
model<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'model name'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// model.name</span>
</code></pre></div><h3 id="lean"><a href="#lean" class="header-anchor">#</a> lean</h3> <p>上方的两个问题 _id 比较， 和 toObject 出现的根本原因是通过mongooses 查询出来的对象还不能算是一个JavaScript 还是一个 Mongoose 的对象，查询出来的对象是可以进行 update, create, delete 等一系列的操作的。</p> <p>这个时候我们可以用 查询的 lean 方法，手动的将查询出来的 mongoose 对象转换为 JavaScript 对象 这个时候就不会有上面的问题了</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>model<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="字段递增、递减"><a href="#字段递增、递减" class="header-anchor">#</a> 字段递增、递减</h3> <p>递增</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">await</span> model<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $inc<span class="token operator">:</span> <span class="token punctuation">{</span>views<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>递减，需要判断当前已经大于 0</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">await</span> model<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">,</span> <span class="token punctuation">{</span>views<span class="token operator">:</span> <span class="token punctuation">{</span>$gt<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $inc<span class="token operator">:</span> <span class="token punctuation">{</span>views<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="常用查询"><a href="#常用查询" class="header-anchor">#</a> 常用查询</h3> <table><thead><tr><th>方法名</th> <th>含义</th> <th></th></tr></thead> <tbody><tr><td>find</td> <td>通用查询，方法的查询结果是数组，即使没查询到内容，也会返回 [] 空数组。</td> <td></td></tr> <tr><td>findById</td> <td><code>Model.findById(id,[projection],[options],[callback])</code></td> <td></td></tr> <tr><td>findOne</td> <td><code>Model.findOne(conditions, [projection], [options], [callback])</code></td> <td>该方法返回查找到的所有实例的第一个</td></tr></tbody></table> <p><strong>操作符</strong></p> <table><thead><tr><th>$eq</th> <th>与指定的值相等</th></tr></thead> <tbody><tr><td>$ne</td> <td>与指定的值不相等</td></tr> <tr><td>$gt</td> <td>大于指定的值</td></tr> <tr><td>$gte</td> <td>大于等于指定的值</td></tr> <tr><td>$lt</td> <td>小于指定的值</td></tr> <tr><td>$lte</td> <td>小于等于指定的值</td></tr> <tr><td>$in</td> <td>与查询数组中指定的值中的任何一个匹配</td></tr> <tr><td>$nin</td> <td>与查询数组中指定的值中的任何一个都不匹配</td></tr></tbody></table> <p><strong>字段相关操作符</strong></p> <table><thead><tr><th>符号</th> <th>描述</th></tr></thead> <tbody><tr><td>$exists</td> <td>匹配存在制定字段的文档</td></tr> <tr><td>$type</td> <td>返回字段属于指定类型的文档</td></tr></tbody></table> <p><strong>数组字段查找</strong></p> <table><thead><tr><th>符号</th> <th>描述</th></tr></thead> <tbody><tr><td>$all</td> <td>匹配包含查询数组中指定的所有条件的数组字段</td></tr> <tr><td>$elemMatch</td> <td>匹配数组字段中的某个值满足 $elemMatch 中指定的所有条件</td></tr> <tr><td>$size</td> <td>匹配数组字段的 length 与指定的大小一样的 document</td></tr></tbody></table> <p><strong>projection 投影</strong></p> <p>其实就是看哪个字段显示，哪个字段不显示</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>UserModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> sex<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的查询就代表了，只显示 name、age、sex 字段</p> <p><strong>Options</strong></p> <table><thead><tr><th>操作</th> <th>作用</th></tr></thead> <tbody><tr><td>sort</td> <td>按照排序规则根据所给的字段进行排序，值可以是 asc，desc，ascending，descending，1，和 -1。</td></tr> <tr><td>limit</td> <td>指定返回结果的最大数量</td></tr> <tr><td>skip</td> <td>指定要跳过的文档数量</td></tr> <tr><td>lean</td> <td>返回普通的 js 对象，而不是 <code>Mongoose Documents</code>。建议不需要 mongoose 特殊处理就返给前端的数据都最好使用该方法转成普通 js 对象。</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在 limit、skip 一起使用时，调用顺序并不重要，返回的数据都是先排序后限制数量</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 效果一样</span>
Model<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Model<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <h3 id="修改"><a href="#修改" class="header-anchor">#</a> 修改</h3> <ul><li>findOneAndUpdate</li> <li>findByIdAndUpdate</li> <li>update</li> <li>updateMany</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Model<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>callback<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// update</span>
<span class="token comment">// {operator: { field: value, ... }}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>必须使用 update 操作符。如果没有操作符或操作符不是 <code>update</code> 操作符，统一被视为 <code>$set</code> 操作（mongoose 特有）</p></div> <p><strong>字段相关操作符</strong></p> <table><thead><tr><th>符号</th> <th>描述</th></tr></thead> <tbody><tr><td>$set</td> <td>设置字段值</td></tr> <tr><td>$currentDate</td> <td>设置字段值为当前时间，可以是 <code>Date</code> 或时间戳格式。</td></tr> <tr><td>$min</td> <td>只有当指定值小于当前字段值时更新</td></tr> <tr><td>$max</td> <td>只有当指定值大于当前字段值时更新</td></tr> <tr><td>$inc</td> <td>将字段值增加<code>指定数量</code>，<code>指定数量</code>可以是负数，代表减少。</td></tr> <tr><td>$mul</td> <td>将字段值乘以指定数量</td></tr> <tr><td>$unset</td> <td>删除指定字段，数组中的值删后改为 null。</td></tr></tbody></table> <p><strong>数组字段相关操作符</strong></p> <table><thead><tr><th>符号</th> <th>描述</th></tr></thead> <tbody><tr><td>$</td> <td>充当占位符，用来表示匹配查询条件的数组字段中的第一个元素 <code>{operator:{ &quot;arrayField.$&quot; : value }}</code></td></tr> <tr><td>$addToSet</td> <td>向数组字段中添加之前不存在的元素 <code>{ $addToSet: {arrayField: value, ... }}</code>，value 是数组时可与 <code>$each</code> 组合使用。</td></tr> <tr><td>$pop</td> <td>向数组字段的末尾添加元素 <code>{ $push: { arrayField: value, ... } }</code>，value 是数组时可与 <code>$each</code> 等修饰符组合使用</td></tr> <tr><td>$pull</td> <td>移除数组字段中的第一个或最后一个元素 <code>{ $pop: {arrayField: -1(first) / 1(last), ... } }</code></td></tr> <tr><td>$pullAll</td> <td>移除数组字段中与查询条件匹配的所有元素 <code>{ $pull: {arrayField: value / condition, ... } }</code></td></tr> <tr><td>$push</td> <td>从数组中删除所有匹配的值 <code>{ $pullAll: { arrayField: [value1, value2 ... ], ... } }</code></td></tr></tbody></table> <p><strong>修饰符</strong></p> <ul><li>$each</li> <li>$position</li> <li>$slice</li> <li>$sort</li></ul> <h3 id="删除"><a href="#删除" class="header-anchor">#</a> 删除</h3> <ul><li>findOneAndDelete</li> <li>findByIdAndDelete</li> <li>deleteMany</li> <li>deleteOne</li> <li>findOneAndRemove</li> <li>findByIdAndRemove</li> <li>remove</li></ul> <h3 id="aggregate"><a href="#aggregate" class="header-anchor">#</a> aggregate</h3> <p><img alt="aggregate" data-src="/assets/img/aggregate.14c59e47.png" loading="lazy" class="lazy"></p> <ul><li><p>$project</p> <p>修改文档的结构，可以用来重命名、增加或删除文档中字段</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//只返回a和b字段</span>
Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        $project<span class="token operator">:</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>$match</p> <p>用于过滤文档，用法类似于find()方法中的参数</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">//返回符合price大于或等于100的数据</span>
Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        $match<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">'price'</span><span class="token operator">:</span> <span class="token punctuation">{</span> $gte<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div></li> <li><p>$limit</p> <p>只返回一条数据</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        $limit<span class="token operator">:</span> <span class="token number">1</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>$skip</p> <p>跳过第一条，返回之后的数据</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        $skip<span class="token operator">:</span> <span class="token number">1</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>$sort</p> <p>以price倒序排列</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        $sort<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">'price'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>$group</p> <p>以order_id进行分组，并统计每组的数量</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        $group<span class="token operator">:</span> <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token string">&quot;$order_id&quot;</span><span class="token punctuation">,</span> total<span class="token operator">:</span> <span class="token punctuation">{</span>$sum<span class="token operator">:</span> <span class="token string">&quot;$num&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>$lookup</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        $lookup<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'student'</span><span class="token punctuation">,</span> <span class="token comment">// 和student表进行关联</span>
            localField<span class="token operator">:</span> <span class="token string">'class_id'</span><span class="token punctuation">,</span> <span class="token comment">// 此表字段名为 class_id</span>
            foreignField<span class="token operator">:</span> <span class="token string">'class_id'</span><span class="token punctuation">,</span> <span class="token comment">// 关联表中字段为 class_id</span>
            <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">'students'</span> <span class="token comment">// 用students 字段接收符合要求的内容</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div></li></ul> <h3 id="mongodb-导入导出"><a href="#mongodb-导入导出" class="header-anchor">#</a> MongoDB 导入导出</h3> <p>导出</p> <div class="language-shell extra-class"><pre class="language-shell"><code>mongodump --archive<span class="token operator">=</span>egg_xgimi_app.gz --gzip --db<span class="token operator">=</span>egg_xgimi_app
</code></pre></div><p>导入</p> <div class="language-shell extra-class"><pre class="language-shell"><code>mongorestore -h <span class="token number">127.0</span>.0.1 -d 导入的数据库库名称

mongorestore --gzip --archive<span class="token operator">=</span><span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span>.agz --db <span class="token builtin class-name">test</span> -u <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> -p <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span> --authenticationDatabase <span class="token string">'admin'</span> --port <span class="token number">27000</span> --host <span class="token operator">&lt;</span>hostname<span class="token operator">&gt;</span>
</code></pre></div><h3 id="model-virtual"><a href="#model-virtual" class="header-anchor">#</a> Model Virtual</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>mongoose 的 virtual 需要配合  populate 使用，有奇效</p></div> <div class="language-js extra-class"><pre class="language-js"><code>  
Task<span class="token punctuation">.</span><span class="token function">virtual</span><span class="token punctuation">(</span><span class="token string">'comment'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    ref<span class="token operator">:</span> <span class="token string">'Comment'</span><span class="token punctuation">,</span>
    localField<span class="token operator">:</span> <span class="token string">'_id'</span><span class="token punctuation">,</span>
    foreignField<span class="token operator">:</span> <span class="token string">'task'</span><span class="token punctuation">,</span>
    justOne<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    count<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="固定集合-capped"><a href="#固定集合-capped" class="header-anchor">#</a> 固定集合 capped</h3> <p>在某些特定场景下，我们需要限制数据集和的大小，当它超过固定大小的时候就删除。这个时候就需要 MongoDB 里面的固定集合了</p> <div class="language-json extra-class"><pre class="language-json"><code>const SysLog = new Schema(<span class="token punctuation">{</span>
    type<span class="token operator">:</span> String
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> timestamps<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> versionKey<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> strict<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> capped<span class="token operator">:</span> <span class="token punctuation">{</span> size<span class="token operator">:</span> <span class="token number">1024</span> * <span class="token number">1024</span> * <span class="token number">10</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token number">10000</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>);
</code></pre></div><ul><li>size 配置当前数据集的最大大小 【单位 byte】</li> <li>max 当前数据集的最大条数，两个满足一个就会覆盖</li></ul> <p>通过 <code>db.model.stats()</code> 可以查看当前文档是否是固定集合，和当前集合所使用的条数</p> <details class="custom-block details"><summary>文档详情  db.model.stats()</summary> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> 
    <span class="token property">&quot;ns&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;size&quot;</span> <span class="token operator">:</span> <span class="token number">10484818.0</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;count&quot;</span> <span class="token operator">:</span> <span class="token number">6860.0</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;avgObjSize&quot;</span> <span class="token operator">:</span> <span class="token number">1528.0</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;storageSize&quot;</span> <span class="token operator">:</span> <span class="token number">1060864.0</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;capped&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;max&quot;</span> <span class="token operator">:</span> <span class="token number">10000.0</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;maxSize&quot;</span> <span class="token operator">:</span> <span class="token number">10485760.0</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;sleepCount&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;sleepMS&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;wiredTiger&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;metadata&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;formatVersion&quot;</span> <span class="token operator">:</span> <span class="token number">1.0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;creationString&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;access_pattern_hint=none,allocation_size=4KB,app_metadata=(formatVersion=1),assert=(commit_timestamp=none,durable_timestamp=none,read_timestamp=none),block_allocation=best,block_compressor=snappy,cache_resident=false,checksum=on,colgroups=,collator=,columns=,dictionary=0,encryption=(keyid=,name=),exclusive=false,extractor=,format=btree,huffman_key=,huffman_value=,ignore_in_memory_cache_size=false,immutable=false,internal_item_max=0,internal_key_max=0,internal_key_truncate=true,internal_page_max=4KB,key_format=q,key_gap=10,leaf_item_max=0,leaf_key_max=0,leaf_page_max=32KB,leaf_value_max=64MB,log=(enabled=true),lsm=(auto_throttle=true,bloom=true,bloom_bit_count=16,bloom_config=,bloom_hash_count=8,bloom_oldest=false,chunk_count_limit=0,chunk_max=5GB,chunk_size=10MB,merge_custom=(prefix=,start_generation=0,suffix=),merge_max=15,merge_min=0),memory_page_image_max=0,memory_page_max=10m,os_cache_dirty_max=0,os_cache_max=0,prefix_compression=false,prefix_compression_min=4,source=,split_deepen_min_child=0,split_deepen_per_child=0,split_pct=90,type=file,value_format=u&quot;</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;uri&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;statistics:table:collection-125--2403229025471591555&quot;</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;LSM&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;bloom filter false positives&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;bloom filter hits&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;bloom filter misses&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;bloom filter pages evicted from cache&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;bloom filter pages read into cache&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;bloom filters in the LSM tree&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;chunks in the LSM tree&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;highest merge generation in the LSM tree&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;queries that could have benefited from a Bloom filter that did not exist&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;sleep for LSM checkpoint throttle&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;sleep for LSM merge throttle&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;total size of bloom filters&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;block-manager&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;allocations requiring file extension&quot;</span> <span class="token operator">:</span> <span class="token number">135.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;blocks allocated&quot;</span> <span class="token operator">:</span> <span class="token number">613.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;blocks freed&quot;</span> <span class="token operator">:</span> <span class="token number">469.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;checkpoint size&quot;</span> <span class="token operator">:</span> <span class="token number">741376.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;file allocation unit size&quot;</span> <span class="token operator">:</span> <span class="token number">4096.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;file bytes available for reuse&quot;</span> <span class="token operator">:</span> <span class="token number">303104.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;file magic number&quot;</span> <span class="token operator">:</span> <span class="token number">120897.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;file major version number&quot;</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;file size in bytes&quot;</span> <span class="token operator">:</span> <span class="token number">1060864.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;minor version number&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;btree&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;btree checkpoint generation&quot;</span> <span class="token operator">:</span> <span class="token number">289.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;column-store fixed-size leaf pages&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;column-store internal pages&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;column-store variable-size RLE encoded values&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;column-store variable-size deleted values&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;column-store variable-size leaf pages&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;fixed-record size&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;maximum internal page key size&quot;</span> <span class="token operator">:</span> <span class="token number">368.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;maximum internal page size&quot;</span> <span class="token operator">:</span> <span class="token number">4096.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;maximum leaf page key size&quot;</span> <span class="token operator">:</span> <span class="token number">2867.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;maximum leaf page size&quot;</span> <span class="token operator">:</span> <span class="token number">32768.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;maximum leaf page value size&quot;</span> <span class="token operator">:</span> <span class="token number">67108864.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;maximum tree depth&quot;</span> <span class="token operator">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;number of key/value pairs&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;overflow pages&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;pages rewritten by compaction&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;row-store empty values&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;row-store internal pages&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;row-store leaf pages&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;cache&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;bytes currently in the cache&quot;</span> <span class="token operator">:</span> <span class="token number">12365742.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;bytes dirty in the cache cumulative&quot;</span> <span class="token operator">:</span> <span class="token number">114582203.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;bytes read into cache&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;bytes written from cache&quot;</span> <span class="token operator">:</span> <span class="token number">64606581.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;checkpoint blocked page eviction&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;data source pages selected for eviction unable to be evicted&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;eviction walk passes of a file&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;eviction walk target pages histogram - 0-9&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;eviction walk target pages histogram - 10-31&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;eviction walk target pages histogram - 128 and higher&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;eviction walk target pages histogram - 32-63&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;eviction walk target pages histogram - 64-128&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;eviction walks abandoned&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;eviction walks gave up because they restarted their walk twice&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;eviction walks gave up because they saw too many pages and found no candidates&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;eviction walks gave up because they saw too many pages and found too few candidates&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;eviction walks reached end of tree&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;eviction walks started from root of tree&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;eviction walks started from saved location in tree&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;hazard pointer blocked page eviction&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;in-memory page passed criteria to be split&quot;</span> <span class="token operator">:</span> <span class="token number">4.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;in-memory page splits&quot;</span> <span class="token operator">:</span> <span class="token number">2.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;internal pages evicted&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;internal pages split during eviction&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;leaf pages split during eviction&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;modified pages evicted&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;overflow pages read into cache&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;page split during eviction deepened the tree&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;page written requiring cache overflow records&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;pages read into cache&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;pages read into cache after truncate&quot;</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;pages read into cache after truncate in prepare state&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;pages read into cache requiring cache overflow entries&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;pages requested from the cache&quot;</span> <span class="token operator">:</span> <span class="token number">10404.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;pages seen by eviction walk&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;pages written from cache&quot;</span> <span class="token operator">:</span> <span class="token number">577.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;pages written requiring in-memory restoration&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;tracked dirty bytes in the cache&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;unmodified pages evicted&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;cache_walk&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;Average difference between current eviction generation when the page was last considered&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Average on-disk page image size seen&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Average time in cache for pages that have been visited by the eviction server&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Average time in cache for pages that have not been visited by the eviction server&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Clean pages currently in cache&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Current eviction generation&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Dirty pages currently in cache&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Entries in the root page&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Internal pages currently in cache&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Leaf pages currently in cache&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Maximum difference between current eviction generation when the page was last considered&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Maximum page size seen&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Minimum on-disk page image size seen&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Number of pages never visited by eviction server&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;On-disk page image sizes smaller than a single allocation unit&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Pages created in memory and never written&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Pages currently queued for eviction&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Pages that could not be queued for eviction&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Refs skipped during cache traversal&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Size of the root page&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;Total number of pages currently in cache&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;compression&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;compressed page maximum internal page size prior to compression&quot;</span> <span class="token operator">:</span> <span class="token number">4096.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;compressed page maximum leaf page size prior to compression &quot;</span> <span class="token operator">:</span> <span class="token number">131072.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;compressed pages read&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;compressed pages written&quot;</span> <span class="token operator">:</span> <span class="token number">559.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;page written failed to compress&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;page written was too small to compress&quot;</span> <span class="token operator">:</span> <span class="token number">18.0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;cursor&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;bulk loaded cursor insert calls&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;cache cursors reuse count&quot;</span> <span class="token operator">:</span> <span class="token number">7495.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;close calls that result in cache&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;create calls&quot;</span> <span class="token operator">:</span> <span class="token number">5.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;insert calls&quot;</span> <span class="token operator">:</span> <span class="token number">7154.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;insert key and value bytes&quot;</span> <span class="token operator">:</span> <span class="token number">10950567.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;modify&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;modify key and value bytes affected&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;modify value bytes modified&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;next calls&quot;</span> <span class="token operator">:</span> <span class="token number">362137.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;open cursor count&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;operation restarted&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;prev calls&quot;</span> <span class="token operator">:</span> <span class="token number">293.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;remove calls&quot;</span> <span class="token operator">:</span> <span class="token number">294.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;remove key bytes removed&quot;</span> <span class="token operator">:</span> <span class="token number">525.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;reserve calls&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;reset calls&quot;</span> <span class="token operator">:</span> <span class="token number">18398.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;search calls&quot;</span> <span class="token operator">:</span> <span class="token number">291.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;search near calls&quot;</span> <span class="token operator">:</span> <span class="token number">3088.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;truncate calls&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;update calls&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;update key and value bytes&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;update value size change&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;reconciliation&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;dictionary matches&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;fast-path pages deleted&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;internal page key bytes discarded using suffix compression&quot;</span> <span class="token operator">:</span> <span class="token number">1806.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;internal page multi-block writes&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;internal-page overflow keys&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;leaf page key bytes discarded using prefix compression&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;leaf page multi-block writes&quot;</span> <span class="token operator">:</span> <span class="token number">34.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;leaf-page overflow keys&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;maximum blocks required for a page&quot;</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;overflow values written&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;page checksum matches&quot;</span> <span class="token operator">:</span> <span class="token number">364.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;page reconciliation calls&quot;</span> <span class="token operator">:</span> <span class="token number">52.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;page reconciliation calls for eviction&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;pages deleted&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;session&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;object compaction&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;transaction&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;update conflicts&quot;</span> <span class="token operator">:</span> <span class="token number">0.0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;nindexes&quot;</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;indexBuilds&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>

    <span class="token punctuation">]</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;totalIndexSize&quot;</span> <span class="token operator">:</span> <span class="token number">151552.0</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;indexSizes&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;_id_&quot;</span> <span class="token operator">:</span> <span class="token number">151552.0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;scaleFactor&quot;</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;ok&quot;</span> <span class="token operator">:</span> <span class="token number">1.0</span>
<span class="token punctuation">}</span>

</code></pre></div></details></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后编辑时间:</span> <span class="time">12/21/2020, 12:30:08 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web/MongoDB.html" class="prev">
        MongoDB
      </a></span> <span class="next"><a href="/web/Node 转发文件上传.html">
        Node 转发文件上传
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.27b2d4ce.js" defer></script><script src="/assets/js/4.9a9f6078.js" defer></script><script src="/assets/js/35.62b9a752.js" defer></script>
  </body>
</html>
